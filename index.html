<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <title>BRUTALIST HACKER NEWS</title>
    <meta
      name="viewport"
      content="viewport-fit=cover, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <link rel="icon" type="image/x-icon" href="assets/icon/favicon.ico" />
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#f6d365" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta
      name="description"
      content="Explore Hacker News in a new light with our minimalist and accessible reader. Dive into the latest tech stories, discussions, and insights with ease and comfort. Perfect for those who value clarity, simplicity, and inclusivity in the stucture of webpages. Also an interesting view of brutalist and Cyberpunk aesthetics."
    />
  </head>

  <body>
    <header
      class="title-content layers glitch-slow"
      aria-label="Main navigation"
    >
      <h1 id="title" class="font glitch">hn</h1>
      <nav
        id="nav-button-top"
        class="text-link-button"
        aria-label="Top Stories"
        title="Top Stories"
      >
        [&#128285;]
      </nav>
      <nav
        id="nav-button-new"
        class="text-link-button"
        aria-label="New Stories"
        title="New Stories"
      >
        [🆕]
      </nav>
      <nav
        id="nav-button-best"
        class="text-link-button"
        aria-label="Best Stories"
        title="Best Stories"
      >
        [🏆]
      </nav>
      <nav
        id="nav-button-ask"
        class="text-link-button"
        aria-label="Ask HN"
        title="Ask HN"
      >
        [?]
      </nav>
      <nav
        id="nav-button-show"
        class="text-link-button"
        aria-label="Show HN"
        title="Show HN"
      >
        [👁️]
      </nav>
      <nav
        id="nav-button-job"
        class="text-link-button"
        aria-label="Jobs"
        title="Jobs"
      >
        [$]
      </nav>
      <nav
        id="nav-button-favorites"
        class="text-link-button"
        aria-label="Saved"
        title="Saved"
      >
        [&hearts;]
      </nav>
      <nav
        id="nav-button-settings"
        class="text-link-button"
        aria-label="Settings"
        title="Settings"
      >
        [⚙]
      </nav>
    </header>
    <main class="main-content">
      <section
        id="loading-outlet"
        class="use-gpu-rendering stories-loading-animation"
        style="display: none"
        aria-live="polite"
      ></section>
      <section
        id="top-outlet"
        class="use-gpu-rendering"
        style="display: none"
        aria-live="polite"
      ></section>
      <section
        id="new-outlet"
        class="use-gpu-rendering"
        style="display: none"
        aria-live="polite"
      ></section>
      <section
        id="best-outlet"
        class="use-gpu-rendering"
        style="display: none"
        aria-live="polite"
      ></section>
      <section
        id="ask-outlet"
        class="use-gpu-rendering"
        style="display: none"
        aria-live="polite"
      ></section>
      <section
        id="show-outlet"
        class="use-gpu-rendering"
        style="display: none"
        aria-live="polite"
      ></section>
      <section
        id="job-outlet"
        class="use-gpu-rendering"
        style="display: none"
        aria-live="polite"
      ></section>
      <section
        id="favorites-outlet"
        class="use-gpu-rendering"
        style="display: none"
        aria-live="polite"
      ></section>
      <section
        id="settings-outlet"
        class="use-gpu-rendering"
        style="display: none"
        aria-live="polite"
      >
        <div
          class="settings-content"
          role="table"
          id="settings-content-container"
        >
          <h3>THEME</h3>
          <div class="setting-element" id="setting--color-primary">
            <div class="setting-name" role="label">primary</div>
            <div class="setting-new-value-input">
              <input
                type="color"
                id="setting-input--color-primary"
                style="border-color: var(--color-primary)"
              />
            </div>
            <button
              class="setting-apply-button"
              id="apply-setting--color-primary"
            >
              APPLY
            </button>
            <button
              class="setting-reset-button"
              id="reset-setting--color-primary"
            >
              RESET
            </button>
          </div>
          <div class="setting-element" id="setting--color-secondary">
            <div class="setting-name" role="label">secondary</div>
            <div class="setting-new-value-input">
              <input type="color" id="setting-input--color-secondary" />
            </div>
            <button
              class="setting-apply-button"
              id="apply-setting--color-secondary"
            >
              APPLY
            </button>
            <button
              class="setting-reset-button"
              id="reset-setting--color-secondary"
            >
              RESET
            </button>
          </div>
          <div class="setting-element" id="setting--color-accent-1">
            <div class="setting-name" role="label">accent-1</div>
            <div class="setting-new-value-input">
              <input type="color" id="setting-input--color-accent-1" />
            </div>
            <button
              class="setting-apply-button"
              id="apply-setting--color-accent-1"
            >
              APPLY
            </button>
            <button
              class="setting-reset-button"
              id="reset-setting--color-accent-1"
            >
              RESET
            </button>
          </div>
          <div class="setting-element" id="setting--color-accent-2">
            <div class="setting-name" role="label">accent-2</div>
            <div class="setting-new-value-input">
              <input type="color" id="setting-input--color-accent-2" />
            </div>
            <button
              class="setting-apply-button"
              id="apply-setting--color-accent-2"
            >
              APPLY
            </button>
            <button
              class="setting-reset-button"
              id="reset-setting--color-accent-2"
            >
              RESET
            </button>
          </div>
          <div class="setting-element" id="setting--color-dark">
            <div class="setting-name" role="label">dark</div>
            <div class="setting-new-value-input">
              <input type="color" id="setting-input--color-dark" />
            </div>
            <button class="setting-apply-button" id="apply-setting--color-dark">
              APPLY
            </button>
            <button class="setting-reset-button" id="reset-setting--color-dark">
              RESET
            </button>
          </div>
          <div class="setting-element" id="setting--color-light">
            <div class="setting-name" role="label">light</div>
            <div class="setting-new-value-input">
              <input type="color" id="setting-input--color-light" />
            </div>
            <button
              class="setting-apply-button"
              id="apply-setting--color-light"
            >
              APPLY
            </button>
            <button
              class="setting-reset-button"
              id="reset-setting--color-light"
            >
              RESET
            </button>
          </div>
          <div class="setting-element" id="setting--color-text-main">
            <div class="setting-name" role="label">text-main</div>
            <div class="setting-new-value-input">
              <input type="color" id="setting-input--color-text-main" />
            </div>
            <button
              class="setting-apply-button"
              id="apply-setting--color-text-main"
            >
              APPLY
            </button>
            <button
              class="setting-reset-button"
              id="reset-setting--color-text-main"
            >
              RESET
            </button>
          </div>
        </div>
        <p>... or use pre built theme ...</p>
        <div class="theme-buttons-row">
          <button id="button-theme-default">DEFAULT</button>
          <button id="button-theme-hacker">H@CK3ᴙ</button>
          <button id="button-theme-l33t">l33+</button>
          <button id="button-theme-dream-pop">DrE∀M P♡P</button>
          <button id="button-theme-solar-flare">S☉l@r ⒻⓁⒶⓇⒺ</button>
          <button id="button-theme-hippie">Ħłρρłε</button>
          <button id="button-theme-neon-concrete">N3ØN ₵ØN₵RΣTΣ</button>
          <button id="button-theme-solarpunk">S☼LΛRPUNK</button>
          <button id="button-theme-hyperreality">H¥P3RR34L!TY</button>
          <button id="button-theme-cybernetic-dream">⊂¥βΞ尺ภΞ†เς Ð尺ΞΛⓜ</button>
          <button id="button-theme-steampunk">S†ε@мקцηк</button>
          <button id="button-theme-petal-dream">✿ Pétäl Drëäm ✿</button>
          <button id="button-theme-neo-tokyo">新しい東京</button>
          <button id="button-theme-china">中國龍</button>
          <button id="button-theme-sakura-matsuri">桜ーまつり</button>
          <button id="button-theme-merc">ⓜⓔⓡⓒ</button>
          <button id="button-theme-sao-paulo">🄼🄴🅃🄾́🄿🄾🄻🄸🅂 🄿🄰🅄🄻🄸🅂🅃🄰</button>
          <button id="button-theme-lagos">ḺᾰǤⱺϨ⸚ 𝔽𝕌𝕋𝕌ℝ𝔸</button>
          <button id="button-theme-nyc">𝕟𝕪𝕔</button>
          <button id="button-theme-greyscale">𝔤𝔯𝔢𝔶𝔰𝔠𝔞𝔩𝔢</button>
          <button id="button-theme-street-magic">ⓈⓉⓇⒺⒺⓉ ⓂⒶⒼⒾⒸ</button>
          <button id="button-theme-washington">Ⓦⓐⓢⓗⓘⓝⓖⓣⓞⓝ</button>
          <button id="button-theme-rainbow">✦☾⇢✧⇠☽✦</button>
          <button id="button-theme-miami">MⓘⒶMⓘ</button>
          <button id="button-theme-neo-vegas">𝓝𝓮𝓸 𝓥𝓮𝓰𝓪𝓼</button>
          <button id="button-theme-moto">ⓜⓞⓣⓞ</button>
          <button id="button-theme-delhi">नई नई दिल्ली</button>
          <button id="button-theme-cyber-citrus">ℂ𝕚𝕥𝕣𝕦𝕤</button>
          <button id="button-theme-purple">ⓅⓊⓇⓅⓁⒺ</button>
          <button id="button-theme-noir">∅byssal Noir</button>
          <button id="button-theme-vaporwave">VAPORWAVE</button>
          <button id="button-theme-fuji">🗻🗻🗻</button>
          <button id="button-theme-y2k">ⓨ²ⓚ</button>
          <button id="button-theme-the-spectacle">𝕿𝖍𝖊 𝕾𝖕𝖊𝖈𝖙𝖆𝖈𝖑𝖊</button>
          <button id="button-theme-pastel-goth">𝔓𝔞𝔰𝔱𝔢𝔩 𝔊𝔬𝔱𝔥</button>
          <button id="button-theme-k-punk">𝕂𝕡𝕦𝕟𝕜</button>
          <button id="button-theme-scene">𝚛𝚎𝚜𝚌𝚎𝚗𝚌𝚎</button>
          <button id="button-theme-sleeze">𝕾𝖑𝖊𝖆𝖟𝖊</button>
          <button id="button-theme-aero">Aҽɾσ</button>
          <button id="button-theme-plastic">ℙ𝕝𝕒𝕤𝕥𝕚𝕔</button>
          <button id="button-theme-zine">Z̲̅i̲̅n̲̅e̲̅</button>
          <button id="button-theme-bicycle">ßïçÿçlë"</button>
          <button id="button-theme-mp3">♫ₘₚ₃♫</button>
          <button id="button-theme-away">✉Away✉</button>
          <button id="button-theme-irc">IRC₍ᴵₙₜₑᵣₙₑₜ ᴿₑₗₐᵧ ₢ₕₐₜ₎</button>
          <button id="button-theme-bbs">ßßₛ</button>
          <button id="button-theme-psyc">ᑭѕүᴄʜ</button>
          <button id="button-theme-1984">¹⁹⁸⁴</button>
          <button id="button-theme-board">Ｂｏａｒｄ</button>
          <button id="button-theme-valley">ᐯᗩᒪᒪᕮᎩ</button>
          <button id="button-theme-space">2oo4</button>
          <button id="button-theme-terminal">0DAY</button>
          <button id="button-theme-sudo">sudo rm -rf /*</button>
          <button id="button-theme-korea">한국의 빛</button>
          <button id="button-theme-1999">1999</button>
          <button id="button-theme-y10k">Y₁₀ₖ</button>
          <button id="button-theme-spiral">Spiral✵Galaxy</button>
          <button id="button-theme-radio">Pïrätë🎙️Rädïo</button>
          <button id="button-theme-nakamoto">Genesis₿lock</button>
          <button id="button-theme-space-age">🛸🛸🛸</button>
          <button id="button-theme-uranium">☢️U-235☢️</button>
          <button id="button-theme-plutonium">☢️Pu-239☢️</button>
          <button id="button-theme-eliptic-curve">ɆⱠł₱₮ł₵ ₵ɄⱤVɆ</button>
          <button id="button-theme-exit-node">Ξ𝕏ł𝕋 ℕ𝕆𝔻𝔼</button>
          <button id="button-theme-numbers-station">₦𝕌𝗠𝖡𝖤𝗥$𝕋𝔸𝕋𝕀𝕆ℕ</button>
          <button id="button-theme-salmon">ℕ๏ภςє</button>
          <button id="button-theme-qubit">ҨบᎥƁᎥ†</button>
          <button id="button-theme-san-francisco">S⍺n Fr⍺ncisc0</button>
          <button id="button-theme-los-angeles">L0S@NGeLE$</button>
          <button id="button-theme-hash">ʜᴀѕн</button>
          <button id="button-theme-block-cipher">███ɃŁØ₵ƙ₵ᎥƤђɆя███</button>
          <button id="button-theme-samizdat">самиздат</button>
        </div>

        <br />
        <button id="download-theme-button" class="settings-favorites-button">
          DOWNLOAD CURRENT THEME
        </button>
        <br />
        <br />
        <br />

        <h3>FAVORITES</h3>
        <button
          id="download-favorites-button"
          class="settings-favorites-button"
        >
          DOWNLOAD FAVORITES
        </button>
        <button
          id="clear-all-favorites-button"
          class="settings-favorites-button"
        >
          CLEAR ALL FAVORITES
        </button>

        <br />
        <br />
        <br />

        <section id="pwa-install-instructions" class="pwa-install-section">
          <h3>ADD TO HOME SCREEN (PWA SUPPORT)</h3>
          <p>
            This site is a Progressive Web App (PWA), which is a web page that
            can be installed as an app on most devices. This allows for a more
            app-like experience. To install this page as an app, follow these
            instructions:
          </p>

          <h4>Android</h4>
          <ol>
            <li>
              Tap the menu icon (3 dots in upper right-hand corner) and tap 'Add
              to Home screen'.
            </li>
            <li>
              You'll be able to enter a name for the shortcut and then Chrome
              will add it to your home screen.
            </li>
          </ol>

          <h4>iOS</h4>
          <ol>
            <li>
              Tap the 'Share' button (the square with an arrow pointing out of
              it) at the bottom of the screen.
            </li>
            <li>
              Scroll down to the list of actions and tap 'Add to Home Screen'.
            </li>
            <li>
              Enter a name for the shortcut and then Safari will add it to your
              home screen.
            </li>
          </ol>

          <h4>Chrome/Brave/Opera</h4>
          <ol>
            <li>
              Look for a '+' icon in the address bar at the right or an
              'Install' icon in the right side of the address bar.
            </li>
            <li>
              Click the icon and follow the prompt to install the application.
            </li>
          </ol>

          <h4>Microsoft Edge</h4>
          <ol>
            <li>
              Click on the 'Settings and more' menu (3 dots in upper right-hand
              corner) or look for an 'Install' icon on the right side of the
              address bar.
            </li>
            <li>Select 'Apps' > 'Install this site as an app'.</li>
            <li>Enter a name for the app and confirm the installation.</li>
          </ol>

          <h4>Firefox</h4>
          <ol>
            <li>
              Click on the 'Page Actions' menu (3 dots in the address bar) or
              look for an 'Install' icon on the right side of the address bar.
            </li>
            <li>Select 'Install Site as App'.</li>
            <li>Enter a name for the app and confirm the installation.</li>
          </ol>
        </section>

        <br />

        <h3>ABOUT</h3>
        <p class="about-text">
          An experiment with
          <a
            href="https://brutalist-web.design/"
            title="A popular page about brutalist web design"
          >
            Brutalist Web Design
          </a>
          and <a href="http://vanilla-js.com/">Vanilla JavaScript</a>. Built
          with no libraries, only one HTML/CSS/JS file and the Hacker News API.
          This page is also an exploration of brutalist and cyberpunk aesthetics
          in web design. Acknowledgements to the
          <a
            href="https://news.ycombinator.com/"
            title="The original Hacker News website"
            data-allow-external="true"
            >original Hacker News website</a
          >
          for their API and
          <a
            href="https://codepen.io/mattgrosswork/pen/VwprebG"
            data-allow-external="true"
          >
            Matt Gross</a
          >
          for the glitch animation used in the title bar.

          <br />
          <br />
          You can contribute to the development of this page or give a star on
          <a
            href="https://github.com/wkyleg/brutalist-hacker-news"
            title="The git repository for this website"
            data-allow-external="true"
            >GitHub.</a
          >
          New themes are welcomed! If you have a theme you'd like to see on this
          page, please submit a pull request or open an issue on the GitHub
          repository.

          <br />
          <br />
          <button id="share-website">SHARE THIS WEBSITE</button>
        </p>
      </section>
    </main>
  </body>

  <style>
                                    :root {
                                      /* Default color scheme inspired by brutalist design and cyberpunk */
                                      --color-primary:#e30613;
                                      --color-secondary: #ffed00;
                                      --color-accent-1: #f6d365;
                                      --color-accent-2: #fda085;
                                      --color-dark: #3c3c3c
                                      --color-light: #FFFFFF;
                                      --color-text-main: #2f4f4f ;

                                      /* Shading Utilities */
                                      --text-shadow-highlight: 1px 1px var(--color-primary),
                                        -1px -1px var(--color-secondary);
                                      --box-shadow-highlight: 5px 5px var(--color-primary),
                                        -5px -5px var(--color-secondary);
                                      --box-shadow-highlight-mild: 1px 1px var(--color-primary),
                                        -1px -1px var(--color-secondary);
                                      --backgound-linear-gradient: linear-gradient(
                                        120deg,
                                        var(--color-accent-1) 0%,
                                        var(--color-accent-2) 100%
                                      );

                                      /* Sizing utilities */
                                      --size-xxs: 0.5rem;
                                      --size-xs: 0.75rem;
                                      --size-sm: 1rem;
                                      --size-md: 1.5rem;
                                      --size-lg: 2rem;
                                      --size-xl: 3rem;
                                      --size-xxl: 6rem;

                                      /* Breakpoints */
                                      --breakpoint-mobile: 600px;
                                      --breakpoint-tablet: 1100px;
                                      --breakpoint-desktop: 1600px;

                                      /* Misc */
                                      --top-level-padding-side: 1%;
                                      --modal-border-width: 3px;
                                    }

                                    * {
                                      /*  Default to best Apple Monospace fonts, then Chrome fonts, then windows fonts */
                                      font-family: "Menlo", "SF Mono", "Inconsolata", "Fira Code", "Roboto Mono", "Consolas", "Liberation Mono", "Courier New", monospace;
                                      border-radius: 0;
                                      color: var(--color-text-main);
                                      border: 0;
                                      scrollbar-color: var(--color-primary) var(--color-secondary);
                                      scrollbar-width: auto;
                                      transition: all 0.2s ease-in-out;
                                    }

                                    input {
                                      color: var(--color-text-main);
                                      padding-block: 0;
                                      padding-inline: 0;
                                      margin-block: 0;
                                      margin-inline: 0;
                                    }

                                    a {
                                      color: var(--color-primary);
                                      text-decoration: underline;
                                      cursor: pointer;
                                      color: var(--color-text-main);
                                    }

                                    a:hover {
                                      color: var(--color-primary);
                                    }

                                    a:visited {
                                      background-color: rgb(from var(--color-text-main) r g b / .5);
                                    }

                                    a:visited:hover {
                                      color: var(--color-secondary);
                                    }


                                    button {
                                      cursor: pointer;
                                      background: var(--color-light);
                                      color: var(--color-text-main);
                                      transition: all 0.2s ease-in-out;
                                    }

                                    button, a, input {
                                      transition: all 0.1s ease-in-out;
                                    }

                                    .settings-favorites-button {
                                      height: var(--size-md);
                                    }

                                    button:hover {
                                      filter: brightness(1.2), contrast(1.2);
                                      box-shadow: inset 1px 1px 1px var(--color-text-main);
                                    }

                                    .type {
      font-size: 1rem;
      display:inline-flex;
    }

    .type span {
      height: 1.2rem;
      width:0%;
      word-break:break-all;
      overflow: hidden;
      animation:
        c 0.5s infinite steps(1),
        t 2s linear infinite;
    }
    .type span:before {
      content:" ";
      display:inline-block;
    }

    @keyframes t{
      90%,100% {width:100%}
    }

    @keyframes c{
      0%,100%{box-shadow: 0.66rem 0 0 transparent}
      50%    {box-shadow: 0.66rem 0 0 var(--color-primary)  }
    }


                                    @keyframes subtleGlowWarble {
                              0% {
                                filter: brightness(100%) opacity(1) saturate(100%) contrast(100%);
                              }
                              25% {
                                filter: brightness(105%) opacity(0.95) saturate(105%) contrast(105%);
                              }
                              50% {
                                filter: brightness(100%) opacity(1) saturate(100%) contrast(100%);
                              }
                              75% {
                                filter: brightness(95%) opacity(1.05) saturate(95%) contrast(95%);
                              }
                              100% {
                                filter: brightness(100%) opacity(1) saturate(100%) contrast(100%);
                              }
                            }

                                /* Glitch Animation */
                                /*
                                * Inspired by https://codepen.io/mattgrosswork/pen/VwprebG
                                */

                                .layers {
                                  position: relative;
                                }

                                .layers::before,
                                .layers::after {
                                  content: attr(data-text);
                                  position: absolute;
                                  width: 110%;
                                  z-index: -1;
                                }

                                .layers::before {
                                  top: 10px;
                                  left: 15px;
                                  color: var(--color-primary);
                                }

                                        .layers::after {
                                          top: 5px;
                                          left: -10px;
                                          color: var(--color-secondary);
                                    }

                                        .single-path {
                                          clip-path: polygon(
                                            0% 12%,
                                            53% 12%,
                                            53% 26%,
                                            25% 26%,
                                            25% 86%,
                                            31% 86%,
                                            31% 0%,
                                            53% 0%,
                                            53% 84%,
                                            92% 84%,
                                            92% 82%,
                                            70% 82%,
                                            70% 29%,
                                            78% 29%,
                                            78% 65%,
                                            69% 65%,
                                            69% 66%,
                                            77% 66%,
                                            77% 45%,
                                            85% 45%,
                                            85% 26%,
                                            97% 26%,
                                            97% 28%,
                                            84% 28%,
                                            84% 34%,
                                            54% 34%,
                                            54% 89%,
                                            30% 89%,
                                            30% 58%,
                                            83% 58%,
                                            83% 5%,
                                            68% 5%,
                                            68% 36%,
                                            62% 36%,
                                            62% 1%,
                                            12% 1%,
                                            12% 34%,
                                            60% 34%,
                                            60% 57%,
                                            98% 57%,
                                            98% 83%,
                                            1% 83%,
                                            1% 53%,
                                            91% 53%,
                                            91% 84%,
                                            8% 84%,
                                            8% 83%,
                                            4% 83%
                                          );
                                        }

                                        .paths {
                                          animation: paths 5s step-end infinite;
                                        }

                                        @keyframes paths {
                                          0% {
                                            clip-path: polygon(
                                              0% 43%,
                                              83% 43%,
                                              83% 22%,
                                              23% 22%,
                                              23% 24%,
                                              91% 24%,
                                              91% 26%,
                                              18% 26%,
                                              18% 83%,
                                              29% 83%,
                                              29% 17%,
                                              41% 17%,
                                              41% 39%,
                                              18% 39%,
                                              18% 82%,
                                              54% 82%,
                                              54% 88%,
                                              19% 88%,
                                              19% 4%,
                                              39% 4%,
                                              39% 14%,
                                              76% 14%,
                                              76% 52%,
                                              23% 52%,
                                              23% 35%,
                                              19% 35%,
                                              19% 8%,
                                              36% 8%,
                                              36% 31%,
                                              73% 31%,
                                              73% 16%,
                                              1% 16%,
                                              1% 56%,
                                              50% 56%,
                                              50% 8%
                                            );
                                          }

                                          5% {
                                            clip-path: polygon(
                                              0% 29%,
                                              44% 29%,
                                              44% 83%,
                                              94% 83%,
                                              94% 56%,
                                              11% 56%,
                                              11% 64%,
                                              94% 64%,
                                              94% 70%,
                                              88% 70%,
                                              88% 32%,
                                              18% 32%,
                                              18% 96%,
                                              10% 96%,
                                              10% 62%,
                                              9% 62%,
                                              9% 84%,
                                              68% 84%,
                                              68% 50%,
                                              52% 50%,
                                              52% 55%,
                                              35% 55%,
                                              35% 87%,
                                              25% 87%,
                                              25% 39%,
                                              15% 39%,
                                              15% 88%,
                                              52% 88%
                                            );
                                          }

                                          30% {
                                            clip-path: polygon(
                                              0% 53%,
                                              93% 53%,
                                              93% 62%,
                                              68% 62%,
                                              68% 37%,
                                              97% 37%,
                                              97% 89%,
                                              13% 89%,
                                              13% 45%,
                                              51% 45%,
                                              51% 88%,
                                              17% 88%,
                                              17% 54%,
                                              81% 54%,
                                              81% 75%,
                                              79% 75%,
                                              79% 76%,
                                              38% 76%,
                                              38% 28%,
                                              61% 28%,
                                              61% 12%,
                                              55% 12%,
                                              55% 62%,
                                              68% 62%,
                                              68% 51%,
                                              0% 51%,
                                              0% 92%,
                                              63% 92%,
                                              63% 4%,
                                              65% 4%
                                            );
                                          }

                                          45% {
                                            clip-path: polygon(
                                              0% 33%,
                                              2% 33%,
                                              2% 69%,
                                              58% 69%,
                                              58% 94%,
                                              55% 94%,
                                              55% 25%,
                                              33% 25%,
                                              33% 85%,
                                              16% 85%,
                                              16% 19%,
                                              5% 19%,
                                              5% 20%,
                                              79% 20%,
                                              79% 96%,
                                              93% 96%,
                                              93% 50%,
                                              5% 50%,
                                              5% 74%,
                                              55% 74%,
                                              55% 57%,
                                              96% 57%,
                                              96% 59%,
                                              87% 59%,
                                              87% 65%,
                                              82% 65%,
                                              82% 39%,
                                              63% 39%,
                                              63% 92%,
                                              4% 92%,
                                              4% 36%,
                                              24% 36%,
                                              24% 70%,
                                              1% 70%,
                                              1% 43%,
                                              15% 43%,
                                              15% 28%,
                                              23% 28%,
                                              23% 71%,
                                              90% 71%,
                                              90% 86%,
                                              97% 86%,
                                              97% 1%,
                                              60% 1%,
                                              60% 67%,
                                              71% 67%,
                                              71% 91%,
                                              17% 91%,
                                              17% 14%,
                                              39% 14%,
                                              39% 30%,
                                              58% 30%,
                                              58% 11%,
                                              52% 11%,
                                              52% 83%,
                                              68% 83%
                                            );
                                          }

                                          76% {
                                            clip-path: polygon(
                                              0% 26%,
                                              15% 26%,
                                              15% 73%,
                                              72% 73%,
                                              72% 70%,
                                              77% 70%,
                                              77% 75%,
                                              8% 75%,
                                              8% 42%,
                                              4% 42%,
                                              4% 61%,
                                              17% 61%,
                                              17% 12%,
                                              26% 12%,
                                              26% 63%,
                                              73% 63%,
                                              73% 43%,
                                              90% 43%,
                                              90% 67%,
                                              50% 67%,
                                              50% 41%,
                                              42% 41%,
                                              42% 46%,
                                              50% 46%,
                                              50% 84%,
                                              96% 84%,
                                              96% 78%,
                                              49% 78%,
                                              49% 25%,
                                              63% 25%,
                                              63% 14%
                                            );
                                          }

                                          90% {
                                            clip-path: polygon(
                                              0% 41%,
                                              13% 41%,
                                              13% 6%,
                                              87% 6%,
                                              87% 93%,
                                              10% 93%,
                                              10% 13%,
                                              89% 13%,
                                              89% 6%,
                                              3% 6%,
                                              3% 8%,
                                              16% 8%,
                                              16% 79%,
                                              0% 79%,
                                              0% 99%,
                                              92% 99%,
                                              92% 90%,
                                              5% 90%,
                                              5% 60%,
                                              0% 60%,
                                              0% 48%,
                                              89% 48%,
                                              89% 13%,
                                              80% 13%,
                                              80% 43%,
                                              95% 43%,
                                              95% 19%,
                                              80% 19%,
                                              80% 85%,
                                              38% 85%,
                                              38% 62%
                                            );
                                          }

                                          1%,
                                          7%,
                                          33%,
                                          47%,
                                          78%,
                                          93% {
                                            clip-path: none;
                                          }
                                        }

                                        .movement {
                                          /* Normally this position would be absolute & on the layers, set to relative here so we can see it on the div */
                                          position: relative;
                                          animation: movement 8s step-end infinite;
                                        }

                                        @keyframes movement {
                                          0% {
                                            top: 0px;
                                            left: -20px;
                                          }

                                          15% {
                                            top: 10px;
                                            left: 10px;
                                          }

                                          60% {
                                            top: 5px;
                                            left: -10px;
                                          }

                                          75% {
                                            top: -5px;
                                            left: 20px;
                                          }

                                          100% {
                                            top: 10px;
                                            left: 5px;
                                          }
                                        }

                                        .opacity {
                                          animation: opacity 5s step-end infinite;
                                        }

                                        @keyframes opacity {
                                          0% {
                                            opacity: 0.1;
                                          }

                                          5% {
                                            opacity: 0.7;
                                          }

                                          30% {
                                            opacity: 0.4;
                                          }

                                          45% {
                                            opacity: 0.6;
                                          }

                                          76% {
                                            opacity: 0.4;
                                          }

                                          90% {
                                            opacity: 0.8;
                                          }

                                          1%,
                                          7%,
                                          33%,
                                          47%,
                                          78%,
                                          93% {
                                            opacity: 0;
                                          }
                                        }

                                        .font {
                                          animation: font 7s step-end infinite;
                                        }

                                          @keyframes font {
                                              0% {
                                                font-weight: 100;
                                                color: var(--color-primary);
                                                filter: blur(3px);
                                              }

                                              20% {
                                                font-weight: 500;
                                                color: var(--color-light);
                                                filter: blur(0);
                                              }

                                              50% {
                                                font-weight: 300;
                                                color: var(--color-accent-2);
                                                filter: blur(2px);
                                              }

                                              60% {
                                                font-weight: 700;
                                                color: var(--color-accent-1);
                                                filter: blur(0);
                                              }

                                              90% {
                                                font-weight: 500;
                                                color: var(--color-primary);
                                                filter: blur(6px);
                                              }
                                            }

                                            .glitch {
                                              animation: paths 3s step-end infinite;
                                            }

                                            .glitch::before {
                                              animation: paths 5s step-end infinite, opacity 5s step-end infinite,
                                                font 8s step-end infinite, movement 10s step-end infinite;
                                            }

                                            .glitch::after {
                                              animation: paths 5s step-end infinite, opacity 5s step-end infinite,
                                                font 7s step-end infinite, movement 8s step-end infinite;
                                            }

                                            .glitch-slow {
                                              animation: paths 10s step-end infinite;
                                            }

                                            .glitch-slow::before {
                                              animation: paths 5s step-end infinite, opacity 5s step-end infinite,
                                                font 8s step-end infinite, movement 10s step-end infinite;
                                            }

                                            .glitch-slow::after {
                                              animation: paths 5s step-end infinite, opacity 5s step-end infinite,
                                                font 7s step-end infinite, movement 8s step-end infinite;
                                            }

                                            ::-webkit-scrollbar {
                                              width: var(--size-lg);
                                              min-width: var(--size-lg);
                                            }

                                            ::-webkit-scrollbar-track {
                                              background: var(--color-accent-1);
                                            }

                                            ::-webkit-scrollbar-thumb {
                                              background: var(--color-primary);
                                              border-radius: 0px;
                                              min-height: var(--size-xxl);
                                              z-index: 100;
                                            }

                                            ::-webkit-scrollbar-track:active {
                                              background: var(--color-secondary);
                                            }

                                            ::-webkit-scrollbar-track:hover {
                                              background: var(--color-secondary);
                                            }

                                            ::-webkit-scrollbar-thumb:active {
                                              box-shadow: 1px 3px var(--text-color);
                                            }

                                            ::-webkit-scrollbar-thumb:hover {
                                              box-shadow: 1px 3px var(--color-text-main);
                                            }

                                            body {
                                              margin: 0;
                                              padding: 0;
                                              height: 100%;
                                              width: 100%;
                                              overflow: hidden;
                                            }

                                            h1 {
                                              font-size: var(--size-md);
                                              text-align: center;
                                              color: transparent;
                                              text-shadow: var(--text-shadow-highlight);
                                              font-weight: bold;
                                            }

                                            h3 {
                                              margin-top: 0;
                                              margin-bottom: var(--size-xs);
                                              color: var(--color-primary);
                                            }

                                            pre, code {
                                              word-break: break-word;
                                              word-wrap: break-word;
                                              text-wrap: wrap;
                                            }

                                            .use-gpu-rendering {
                                              -webkit-transform: translate3d(0, 0, 0);
                                              -moz-transform: translate3d(0, 0, 0);
                                              -ms-transform: translate3d(0, 0, 0);
                                              transform: translate3d(0, 0, 0);
                                              -webkit-backface-visibility: hidden;
                                              -moz-backface-visibility: hidden;
                                              -ms-backface-visibility: hidden;
                                              backface-visibility: hidden;
                                              -webkit-perspective: 1000;
                                              -moz-perspective: 1000;
                                              -ms-perspective: 1000;
                                              perspective: 1000;
                                              -webkit-transform: translateZ(0);
                                              -moz-transform: translateZ(0);
                                              -ms-transform: translateZ(0);
                                              -o-transform: translateZ(0);
                                            }

                                            @keyframes fade-in {
                                              from {
                                                opacity: 0;
                                              }
                                              to {
                                                opacity: 1;
                                              }

                                            }

                                            .modal {
                                              display: flex;
                                              flex-direction: column;
                                              position: absolute;
                                              z-index: 1;
                                              left: 0;
                                              top: 0;
                                              width: 50%;
                                              height: 50%;
                                              overflow: auto;
                                              background-color: var(--color-light);
                                              background: var(--color-light);
                                              border: var(--color-primary) var(--modal-border-width) solid;
                                              resize: both;
                                              box-shadow: var(--box-shadow-highlight);
                                              z-index: 15;
                                              overflow: auto;
                                              transition: bottom 0.5s;
                                              animation: fade-in 0.5s;

                                            }

                                            .title-actions-modal .modal-action-buttons {
                                              display: flex;
                                              flex-direction: row;
                                              flex-grow: 1;
                                              width: 30%;
                                            }

                                            .title-actions-modal .title-actions-modal-title {
                                              display: flex;
                                              flex-direction: row;
                                              flex-grow: 1;
                                              text-align: center;
                                              justify-content: center;
                                              align-items: center;
                                              width: 36.6%;
                                              font-size: var(--size-sm);
                                            }

                                            .title-actions-modal .spacer {
                                              display: flex;
                                              flex-direction: row;
                                              flex-grow: 1;
                                              width: 33.3%;
                                            }

                                            .modal-window-title {
                                              cursor: move;
                                              height: var(--size-lg);
                                              font-size: var(--size-md);
                                              position: sticky;
                                              display: flex;
                                              align-items: center;
                                              background-color: var(--color-accent-1);
                                              color: var(--color-text-main);
                                              justify-content: flex-start;
                                              border-bottom: var(--color-primary) 3px solid;
                                              box-shadow: var(--box-shadow-highlight);
                                              width: 100%;
                                              padding-left: var(--top-level-padding-side);
                                              animation: subtleGlowWarble 3s infinite ease-in-out;
                                            }

                                            .modal-window.title nav {
                                              z-index: 100;
                                            }

                                            .modal-window-title:hover {
                                              background-color: var(--color-secondary);
                                            }

                                            .title-actions-modal h3 {
                                              text-align: left;
                                            }

                                            .user-description {
                                              color: var(--color-text-main);
                                              font-size: var(--size-sm);
                                            }

                                            .user-description, .user-submitted {
                                              padding: var(--size-xs);
                                              margin-bottom: var(--size-md);
                                              border: var(--color-primary) 1px solid;
                                            }

                                            .user-description:hover, .user-submitted:hover {
                                              box-shadow: var(--box-shadow-highlight-mild);
                                            }

                                            @media screen and (max-width: 1100px) {
                                              .modal-window-title {
                                                font-size: var(--size-xs);
                                              }
                                            }

                                            .text-link-button {
                                              color: var(--text-color);
                                              text-decoration: none;
                                              cursor: pointer;
                                              transition: text-indent 0.5s;
                                              font-size: var(--size-sm);
                                              background: transparent;
                                              border: 0;
                                            }

                                            @media screen and (max-width: 600px) {
                                              .text-link-button {
                                                font-size: var(--size-sm);
                                              }
                                            }

                                            .text-link-button--selected {
                                              color: var(--color-primary);
                                              font-weight: bolder;
                                            }

                                            .text-link-button:hover {
                                              color: var(--color-primary);
                                              text-shadow: var(--text-shadow-highlight);
                                            }

                                            .modal-content {
                                              flex-grow: 1;
                                              height: 100%;
                                              overflow: hidden;
                                              overflow-y: hidden;
                                              background-color: var(--color-light);
                                              background: var(--color-light);
                                            }

                                            .modal-content-post-share {
                                              display: flex;
                                              flex-direction: column;
                                              width: 100%;
                                              height: calc(100% - var(--size-lg));
                                              background: var(--color-light);
                                              align-items: flex-start;
                                              padding: var(--size-xs);
                                              font-size: var(--size-lg);
                                              overflow-x: scroll;
                                              overflow-y: scroll;
                                            }

                                            .modal-content-post-share nav {
                                              font-size: var(--size-md);
                                              margin-bottom: var(--size-xs);
                                            }


                                            iframe {
                                              width: 100%;
                                              height: 100%;
                                              background: var(--color-light);
                                            }

                                            .modal-content-post {
                                              padding: var(--size-md);
                                              overflow-y: scroll;
                                              height: calc(100% - var(--size-lg));
                                              background: var(--color-light);
                                            }

                                            .story-summary-statistics {
                                              font-size: var(--size-xss);
                                              text-align: center;
                                              font-style: italic;
                                            }

                                            .modal-content-post h3 {
                                              text-align: center;
                                            }

                                            .modal-content-post .story-text {
                                              font-size: var(--size-xs);
                                            }

                                            .modal-content-post p {
                                              font-size: var(--size-xs);
                                              word-wrap: break-word;
                                            }

                                            .modal-content-post code, a, pre {
                                              word-wrap: break-word;
                                            }

                                            .comment {
                                              font-size: var(--size-xs);
                                              padding: var(--size-xs);
                                              margin: var(--size-xs);
                                              border: var(--color-primary) 1px solid;
                                              background: var(--color-light);
                                              min-width: 10vw;
                                              transition: all 0.5s;
                                              animation: fade-in 0.5s;
                                            }

                                            @media screen and (max-width: 600px) {
                                              .comment {
                                                font-size: var(--size-xxs);
                                                padding: var(--size-xxs);
                                                margin: var(--size-xxs);
                                                min-width: 33vw;
                                              }
                                            }

                                            .modal-content-post .comment p {
                                              margin-top: 0;
                                            }

                                            .comment:hover {
                                              box-shadow: var(--box-shadow-highlight-mild);
                                            }


                                            .title-content {
                                              position: fixed;
                                              height: var(--size-lg);
                                              width: 100%;
                                              display: flex;
                                              flex-direction: row;
                                              justify-content: flex-start;
                                              align-items: baseline;
                                              padding-left: var(--top-level-padding-side);
                                              background: var(--color-accent-1);
                                              width: 100%;
                                              z-index: 10;
                                            }

                                            .title-content:hover {
                                              background: var(--color-secondary);
                                            }

                                            .title-content h1 {
                                              margin: 0 var(--size-xs) 0 0;
                                            }

                                            .main-content {
                                              background-image: var(--backgound-linear-gradient);
                                              padding-left: var(--top-level-padding-side);
                                              padding-right: var(--top-level-padding-side);
                                              height: calc(100vh - var(--size-lg));
                                              max-height: calc(100vh - var(--size-lg));
                                              overflow-y: scroll;
                                              padding-top: var(--size-lg);
                                            }

                                            .main-content > section {
                                              transition: all 0.5s;
                                              animation: fade-in 0.5s;
                                            }

                                            .story-container {
                                              margin-top: var(--size-xxs);
                                              margin-bottom: var(--size-xxs);
                                              text-rendering: optimizeSpeed;
                                            }

                                            .story-container span {
                                              color: var(--color-text-main);
                                              font-size: var(--size-sm);
                                              cursor: pointer;
                                            }

                                            .story-container span:hover {
                                              color: transparent;
                                              font-weight: bold;
                                              text-indent: 5px;
                                              transition: text-indent 0.5s;
                                              text-shadow: var(--text-shadow-highlight);
                                            }

                                            .story-container span:hover::before {
                                              display: inline-block;
                                              content: "->";
                                            }

                                            .settings-content {
                                              display: flex;
                                              flex-direction: column;
                                              align-items: flex-start;
                                              justify-content: left;
                                              padding-top: var(--size-xxs);
                                              animation: fade-in 0.5s;
                                            }

                                            .setting-element {
                                              display: flex;
                                              flex-direction: row;
                                              align-items: center;
                                              justify-content: space-between;
                                              padding: var(--size-xxs);
                                            }

                                            .setting-element:hover {
                                              background: var(--color-secondary);
                                            }

                                            .setting-name {
                                              min-width: var(--size-xxl);
                                            }

                                            .setting-new-value-input {
                                              background: transparent;
                                              border: 0;
                                            }

                                            .setting-apply-button, .setting-reset-button {
                                              height: var(--size-md);
                                            }

                                            .settings-content button {
                                              margin-left: var(--size-xs);
                                            }

                                            .settings-content input {
                                              height: var(--size-md);
                                              margin-top: 6px;
                                              margin-bottom: 6px;
                                            }

                                            .theme-buttons-row button {
                                              margin-bottom: var(--size-xs);
                                              height: var(--size-md);
                                            }

                                            .about-text button {
                                              margin-bottom: var(--size-xs);
                                              height: var(--size-md);
                                            }
  </style>

  <!-- Constants -->
  <script type="text/javascript">
    const MEDIA_URL = "https://brutalisthackernews.com/icon.png";
    const YCOMBINATOR_URL = "https://news.ycombinator.com/";
    const MILLISECONDS_IN_SECOND = 1_000;
    const TOTAL_ANIMATION_STRINGS = 100;
    const LOADING_STRING_MIN_LENGTH = 5;
    const LOADING_STRING_MAX_LENGTH = 80;
    const MOBILE_DEVICE_MAX_WIDTH = 600;
    const LOADING_STORY_ANIMATION_REFRESH_INTERVAL_MINIMUM = 250;
    const LOADING_STORY_ANIMATION_REFRESH_INTERVAL_MAXIMUM = 2_000;
    const LOADING_ANIMATION_NUMBER_OF_ROWS = 50;
    const MODAL_POSITION_RANDOM_OFFSET = 10;
    const ANIMATION_CHARACTERS_STRING =
      "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_+=-[]{}|;:,.<>?♥♦♣♠•◘○◆☻☺♂♀♪♫☼►◄↕‼¶§▬↨↑↓→←∟↔▲▼ァアィイゥウェエォオカガキギクゲゴサザシジスゼソゾタダチヂッツヅテデトドナニヌネノハバパヒビピフブプヘベペホボポマミムメモャユョヨラリルレロヮワヰヱヲン々〆〤￥「」『』【】〒〓─━│┃┄┅┆┇┈┉┊┋┌┍┎┏┐┑┒┓└┕┖┗┘┙┚┛├┝┞┟┠┡┢┣┤┥┦┧┨┩┪┫┬┭┮┯┰┱┲┳┴┵┶┷┸┹┺┻┼┽┾┿╀╁╂╃╄╅╆╇╈╉╊╋╌╍╎╏═║╒╓╔╕╖╗╘╙╚╛╜╝╞╟╠╡╢╣╤╥╦╧╨╩╪╫╬§¶☊☋☌☍ΑΒΓΔΕΖΗΘΙΚΛΜΝΞΟΠΡΣΤΥΦΧΨΩαβγδεζηθικλμνξοπρςστυφχψω←↑→↓↔↕↖↗↘↙↚↛↜↝↞↟↠↡↢↣↤↥↦↧↨↩↪↫↬↭↮↯↰↱↲↳↴↵↶↷↸↹↺↻↼↽↾↿⇀⇁⇂⇃⇄⇅⇆⇇⇈⇉⇊⇋⇌⇍⇎⇏⇐⇑⇒⇓⇔⇕⇖⇗⇘⇙⇚⇛⇜⇝⇞⇟⇠⇡⇢⇣⇤⇥⇦⇧⇨⇩⇪⌨";
    const LINK_SHARE_DESCRIPTION =
      "Check out this Hacker News Reader Inspired by Brutalist Web Design and Cyberpunk Aesthetics!";
    const TWITTER_SHARE_URL =
      "https://twitter.com/intent/tweet?text=Check%20out%20this%20awesome%20content&url=";
    const FACEBOOK_SHARE_URL = "https://www.facebook.com/sharer/sharer.php?u=";
    const LINKEDIN_SHARE_URL =
      "https://www.linkedin.com/shareArticle?mini=true&url=";
    const WHATSAPP_SHARE_URL =
      "https://wa.me/?text=Check%20out%20this%20amazing%20site!%20";
    const REDDIT_SHARE_URL =
      "https://reddit.com/submit?url=https://example.com&title=Brutalist%20HN";
    const TELEGRAM_URL =
      "https://telegram.me/share/url?url=https://example.com&text=Check%20out%20this%20site!";
    const EMAIL_SHARE_URL =
      "mailto:?subject=Check%20out%20this%20site!&body=I%20thought%20you%20might%20like%20this%20site:%20";
  </script>

  <!-- API -->
  <script type="text/javascript">
    const HACKER_NEWS_API_URL = "https://hacker-news.firebaseio.com/v0/";
    const HACKER_NEWS_USER_PROFILE_URL =
      "https://news.ycombinator.com/user?id=";

    // TODO: remove coupling with DOM state
    async function getRequestWithLoadingAnimation(url) {
      showLoadingAnimation();
      let response;
      try {
        response = await fetch(url);
        if (!response.ok)
          throw new Error(`HTTP error! status: ${response.status}`);
      } catch (error) {
        console.error(error);
        hideLoadingAnimation();
        throw error;
      } finally {
        hideLoadingAnimation();
      }

      return response.json();
    }

    const itemCache = new Map();

    const API = {
      topStories: () =>
        getRequestWithLoadingAnimation(`${HACKER_NEWS_API_URL}topstories.json`),
      newStories: () =>
        getRequestWithLoadingAnimation(`${HACKER_NEWS_API_URL}newstories.json`),
      bestStories: () =>
        getRequestWithLoadingAnimation(
          `${HACKER_NEWS_API_URL}beststories.json`
        ),
      askStories: () =>
        getRequestWithLoadingAnimation(`${HACKER_NEWS_API_URL}askstories.json`),
      showStories: () =>
        getRequestWithLoadingAnimation(
          `${HACKER_NEWS_API_URL}showstories.json`
        ),
      jobStories: () =>
        getRequestWithLoadingAnimation(`${HACKER_NEWS_API_URL}jobstories.json`),
      /**
     * Stories, comments, jobs, Ask HNs and even polls are just items. They're
     * identified by their ids, which are unique integers, and live under
     * /v0/item/<id>.
     *
     * All items have some of the following properties:
          [Field]     [Description]
          id	        The item's unique id.
          deleted	    true if the item is deleted.
          type    	The type of item. One of "job", "story", "comment", "poll", or "pollopt".
          by	        The username of the item's author.
          time	    Creation date of the item, in Unix Time.
          text    	The comment, story or poll text. HTML.
          dead	    true if the item is dead.
          parent  	The comment's parent: either another comment or the relevant story.
          poll	    The pollopt's associated poll.
          kids	    The ids of the item's comments, in ranked display order.
          url     	The URL of the story.
          score	    The story's score, or the votes for a pollopt.
          title	    The title of the story, poll or job. HTML.
          parts	    A list of related pollopts, in display order.
          descendants	In the case of stories or polls, the total comment count.
      *
      * For example, a story: https://hacker-news.firebaseio.com/v0/item/8863.json?print=pretty
      *
      *
      * @param {number} id
      *
      */
      item: (id) => {
        if (itemCache.has(id)) return Promise.resolve(itemCache.get(id));
        return fetch(`${HACKER_NEWS_API_URL}item/${id}.json`)
          .then((response) => response.json())
          .then((item) => {
            itemCache.set(id, item);
            return item;
          })
          .catch((error) => console.error(error));
      },
      user: (id) => {
        if (itemCache.has(id)) return Promise.resolve(itemCache.get(id));
        return fetch(`${HACKER_NEWS_API_URL}user/${id}.json`)
          .then((response) => response.json())
          .then((item) => {
            itemCache.set(id, item);
            return item;
          })
          .catch((error) => console.error(error));
      },
    };
  </script>

  <!-- Utils -->
  <script type="text/javascript">
    /**
     * Loop utility, does `callback` `times` times
     * @param {number} times
     * @param {function} callback
     * @returns {void}
     */
    const loop = (times, callback) => {
      for (let i = 0; i < times; i++) {
        callback(i);
      }
    };

    function formatDate(timePosted) {
      const date = new Date(timePosted * 1000);
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, "0"); // JavaScript months are 0-based.
      const day = String(date.getDate()).padStart(2, "0");
      const hours = String(date.getHours()).padStart(2, "0");
      const minutes = String(date.getMinutes()).padStart(2, "0");
      const seconds = String(date.getSeconds()).padStart(2, "0");

      // Make sure to avoid Y10K bugs
      return `0${year}:${month}:${day}:${hours}:${minutes}:${seconds}`;
    }

    /**
     * Wait utility, returns a promise that resolves after `timeInMs` milliseconds
     * @param {number} timeInMs
     * @returns {Promise<void>}
     */
    function wait(timeInMs) {
      return new Promise((resolve) => {
        setTimeout(resolve, timeInMs);
      });
    }

    /**
     * Returns a random number between `min` and `max`
     * @param {number} min
     * @param {number} max
     * @returns {number}
     */
    const getRandomNumberBetween = (min, max) =>
      Math.floor(Math.random() * (max - min + 1) + min);

    function getHackerNewsPosterURLFromId(id) {
      return `${HACKER_NEWS_USER_PROFILE_URL}${id}`;
    }

    /**
     * Utility for handling state and side effects, listening for changes
     * @param {any} initialState
     * @param {function} sideEffect
     * @returns {object}
     */
    function reactive(initialState, sideEffect) {
      let state = initialState;
      const current = () => state;

      const update = (newState) => {
        state = newState;
        sideEffect(state);
      };

      const observers = [];
      const subscribe = (observer) => observers.push(observer);

      const notify = () => {
        observers.forEach((observer) => observer(state));
      };

      return {
        current,
        update,
        subscribe,
        notify,
      };
    }

    const _parser = new DOMParser();

    /**
     * Utility for sanitizing external HTML content for malicious scripts
     * @param {string} html
     * @returns {string}
     */
    function sanitize(html) {
      const doc = _parser.parseFromString(html, "text/html");

      // Remove script tags
      doc.querySelectorAll("script").forEach((script) => script.remove());

      // Sanitize attributes
      const elements = doc.body.getElementsByTagName("*");
      for (let i = 0; i < elements.length; i++) {
        const attrs = elements[i].attributes;
        for (let j = attrs.length - 1; j >= 0; j--) {
          const attrName = attrs[j].name.toLowerCase();
          const attrValue = attrs[j].value.toLowerCase();
          if (attrName.startsWith("on") || attrValue.includes("javascript:")) {
            elements[i].removeAttribute(attrs[j].name);
          }
        }
      }

      return doc.body.innerHTML;
    }

    function isMobileDevice() {
      return window.innerWidth < MOBILE_DEVICE_MAX_WIDTH;
    }

    function shareOnTwitter(url) {
      window.open(
        `${TWITTER_SHARE_URL}${url || window.location.href}`,
        "_blank"
      );
    }

    function shareOnFacebook(url) {
      window.open(
        `${FACEBOOK_SHARE_URL}${url || window.location.href}`,
        "_blank"
      );
    }

    function shareOnLinkedIn(url) {
      window.open(
        `${LINKEDIN_SHARE_URL}${url || window.location.href}`,
        "_blank"
      );
    }

    const shareOnWhatsApp = (url) =>
      window.open(
        `${WHATSAPP_SHARE_URL}${url || window.location.href}`,
        "_blank"
      );

    const shareOnReddit = (url) =>
      window.open(
        `${REDDIT_SHARE_URL}${url || window.location.href}`,
        "_blank"
      );

    const shareOnTelegram = (url) =>
      window.open(`${TELEGRAM_URL}${url || window.location.href}`, "_blank");

    const shareViaEmail = (url) =>
      window.open(`${EMAIL_SHARE_URL}${url || window.location.href}`, "_blank");

    const shareOnPintrest = () => {
      window.open(
        `https://pinterest.com/pin/create/button/?url=${encodeURIComponent(
          window.location.href
        )}&media=${encodeURIComponent(
          MEDIA_URL
        )}&description=${encodeURIComponent(LINK_SHARE_DESCRIPTION)}`
      );
    };

    const shareOnTumblr = () => {
      window.open(
        `https://www.tumblr.com/widgets/share/tool?canonicalUrl=${encodeURIComponent(
          window.location.href
        )}&title=${encodeURIComponent(
          "BRUTALIST HACKER NEWS"
        )}&caption=${encodeURIComponent(
          "A Hacker News reader inspired by Brutalist Web Design"
        )}&tags=${encodeURIComponent(
          "brutalist,hackernews,webdesign,cyberpunk,accesibility"
        )}`
      );
    };

    function builtInShare() {
      if (!!navigator.canShare && navigator.canShare() && !!navigator.share) {
        navigator
          .share({
            title: "Check out this article on Brutalist Hacker News",
            text: "Check out this article on Brutalist Hacker News",
            url: window.location.href,
          })
          // .then(() => console.log("Successful share"))
          .catch((error) => shareViaEmail());
      } else {
        shareViaEmail();
      }
    }

    function downloadJSONAsFile(json) {
      const data = JSON.stringify(json, null, 2);
      const blob = new Blob([data], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "data.json";
      a.click();
      URL.revokeObjectURL(url);
    }

    /**
     * Incept all link click events and make sure they open in a new tab
     * @returns {void}
     */
    function initLinkClickInterceptBehavior() {
      document.body.addEventListener("click", function (e) {
        // Check if the clicked element is a link or inside a link
        let target = e.target;
        while (target != null && target.tagName !== "A") {
          target = target.parentElement;
        }

        // If a link was clicked
        if (target && target.tagName === "A") {
          // Check if it's an external link or you want to force it to open in a new tab
          if (
            target.getAttribute("href") &&
            (target.getAttribute("href").startsWith("http") ||
              target.getAttribute("target") === "_blank")
          ) {
            e.preventDefault(); // Prevent default link behavior
            // Check for data-allow-external="true"
            if (target.getAttribute("data-allow-external") === "true")
              return window.open(target.href, "_blank");
            launchLinkModal(target.href);
          }
        }
      });
    }
  </script>

  <!-- Favorites -->
  <script>
    const getFavorites = () =>
      JSON.parse(localStorage.getItem("favorites")) || [];

    const setFavorites = (favorites) =>
      localStorage.setItem("favorites", JSON.stringify(favorites));

    function isStoryFavorited(storyId) {
      return getFavorites().includes(storyId);
    }

    function renderFavorites() {
      const favoriteStoriesElement =
        document.querySelector("#favorites-outlet");
      favoriteStoriesElement.innerHTML = "";
      const fragment = document.createDocumentFragment();
      getFavorites().forEach((storyId) => {
        fragment.appendChild(new StoryListElement(storyId, true));
      });
      favoriteStoriesElement.appendChild(fragment);
      return favoriteStoriesElement;
    }

    function favoriteStory(storyId) {
      const favorites = getFavorites();
      if (favorites.includes(storyId)) return;
      favorites.push(storyId);
      setFavorites(favorites);
      renderFavorites();
    }

    function unfavoriteStory(storyId) {
      setFavorites(getFavorites().filter((id) => id !== storyId));
      renderFavorites();
    }

    function clearAllFavorites() {
      setFavorites([]);
      renderFavorites();
    }

    const downloadFavorites = () => downloadJSONAsFile(getFavorites());

    const attachFavoritesListeners = () => {
      document
        .querySelector("#clear-all-favorites-button")
        .addEventListener("click", clearAllFavorites);

      document
        .querySelector("#download-favorites-button")
        .addEventListener("click", downloadFavorites);
    };
  </script>

  <!-- Settings -->
  <script type="text/javascript">
    const SETTINGS = {
      COLOR_PRIMARY: "--color-primary",
      COLOR_SECONDARY: "--color-secondary",
      COLOR_ACCENT_1: "--color-accent-1",
      COLOR_ACCENT_2: "--color-accent-2",
      COLOR_DARK: "--color-dark",
      COLOR_LIGHT: "--color-light",
      COLOR_TEXT_MAIN: "--color-text-main",
    };

    const SETTING__DEFAULT_VALUES = {
      [SETTINGS.COLOR_PRIMARY]: "#e30613",
      [SETTINGS.COLOR_SECONDARY]: "#ffed00",
      [SETTINGS.COLOR_ACCENT_1]: "#f6d365",
      [SETTINGS.COLOR_ACCENT_2]: "#fda085",
      [SETTINGS.COLOR_DARK]: "#3c3c3c",
      [SETTINGS.COLOR_LIGHT]: "#FFFFFF",
      [SETTINGS.COLOR_TEXT_MAIN]: "#2f4f4f",
    };

    const themes = {
      default: {
        ...SETTING__DEFAULT_VALUES,
      },
      hacker: {
        "--color-primary": "#00ff00",
        "--color-secondary": "#ff00ff",
        "--color-accent-1": "#ff0000",
        "--color-accent-2": "#0000ff",
        "--color-dark": "#000000",
        "--color-light": "#ffffff",
        "--color-text-main": "#00ff00",
      },
      l33t: {
        "--color-primary": "#08fdd8",
        "--color-secondary": "#f800ff",
        "--color-accent-1": "#1b1b1b",
        "--color-accent-2": "#333333",
        "--color-dark": "#080808",
        "--color-light": "#f0f0f0",
        "--color-text-main": "#0033FF",
      },
      "dream-pop": {
        "--color-primary": "#ff77aa",
        "--color-secondary": "#cc99ff",
        "--color-accent-1": "#ff99ee",
        "--color-accent-2": "#d1b3ff",
        "--color-dark": "#342a4e",
        "--color-light": "#fff0f5",
        "--color-text-main": "##808080",
      },
      "solar-flare": {
        "--color-primary": "#ffffff",
        "--color-secondary": "#000000",
        "--color-accent-1": "#ff0000",
        "--color-accent-2": "#ffff00",
        "--color-dark": "#000000",
        "--color-light": "#ffffff",
        "--color-text-main": "#282828",
      },
      hippie: {
        "--color-primary": "#fabd2f",
        "--color-secondary": "#d3869b",
        "--color-accent-1": "#83a598",
        "--color-accent-2": "#b8bb26",
        "--color-dark": "#282828",
        "--color-light": "#ebdbb2",
        "--color-text-main": "#996b00",
      },
      "neon-concrete": {
        "--color-primary": "#00D9FF",
        "--color-secondary": "#FF007F",
        "--color-accent-1": "#8C8C8C",
        "--color-accent-2": "#9A9A9A",
        "--color-dark": "#1A1A1A",
        "--color-light": "#E5E5E5",
        "--color-text-main": "#757575",
      },
      solarpunk: {
        "--color-primary": "#ff8c00",
        "--color-secondary": "#7ec850",
        "--color-accent-1": "#ffd700",
        "--color-accent-2": "#40e0d0",
        "--color-dark": "#005a51",
        "--color-light": "#f0f8ff",
        "--color-text-main": "#3c6e71",
      },
      hyperreality: {
        "--color-primary": "#00ff00",
        "--color-secondary": "#000000",
        "--color-accent-1": "#1A1A1A",
        "--color-accent-2": "#333333",
        "--color-dark": "#0a0a0a",
        "--color-light": "#9A9A9A",
        "--color-text-main": "#00ff00",
      },
      "cybernetic-dream": {
        "--color-primary": "#00D1B2",
        "--color-secondary": "#FF3860",
        "--color-accent-1": "#3273DC",
        "--color-accent-2": "#F5F5F5",
        "--color-dark": "#363636",
        "--color-light": "#FFFFFF",
        "--color-text-main": "#4A4A4A",
      },
      steampunk: {
        "--color-primary": "#bca136",
        "--color-secondary": "#7b3f00",
        "--color-accent-1": "#cc7722",
        "--color-accent-2": "#967117",
        "--color-dark": "#3c3022",
        "--color-light": "#f0e68c",
        "--color-text-main": "#5d4c46",
      },
      "petal-dream": {
        "--color-primary": "#F78FB3",
        "--color-secondary": "#CF9FFF",
        "--color-accent-1": "#A4DEFF",
        "--color-accent-2": "#FFD670",
        "--color-dark": "#7E5475",
        "--color-light": "#ffdbe1",
        "--color-text-main": "#e85995",
      },
      "neo-tokyo": {
        "--color-primary": "#DC143C",
        "--color-secondary": "#FFC0CB",
        "--color-accent-1": "#87CEEB",
        "--color-accent-2": "#32CD32",
        "--color-dark": "#00008B",
        "--color-light": "#FFFFFF",
        "--color-text-main": "#2F4F4F",
      },
      china: {
        "--color-primary": "#A80000",
        "--color-secondary": "#FFD700",
        "--color-accent-1": "#00A86B",
        "--color-accent-2": "#8B4513",
        "--color-dark": "#000000",
        "--color-light": "#FFFAF0",
        "--color-text-main": "#363636",
      },
      "sakura-matsuri": {
        "--color-primary": "#FF69B4",
        "--color-secondary": "#FFD700",
        "--color-accent-1": "#FF6347",
        "--color-accent-2": "#FF1493",
        "--color-dark": "#000000",
        "--color-light": "#FFFAF0",
        "--color-text-main": "#363636",
      },
      merc: {
        "--color-primary": "#4B5320",
        "--color-secondary": "#78866B",
        "--color-accent-1": "#6B8E23",
        "--color-accent-2": "#806B2A",
        "--color-dark": "#3C341F",
        "--color-light": "#F0E68C",
        "--color-text-main": "#333333",
      },
      "sao-paulo": {
        "--color-primary": "#FFD700",
        "--color-secondary": "#C0C0C0",
        "--color-accent-1": "#008000",
        "--color-accent-2": "#A52A2A",
        "--color-dark": "#333333",
        "--color-light": "#F0F0F0",
        "--color-text-main": "#000000",
      },
      lagos: {
        "--color-primary": "#4DB848",
        "--color-secondary": "#FFC107",
        "--color-accent-1": "#00ACC1",
        "--color-accent-2": "#E91E63",
        "--color-dark": "#263238",
        "--color-light": "#E0E0E0",
        "--color-text-main": "#2b6b00",
      },
      nyc: {
        "--color-primary": "#4d4d4d",
        "--color-secondary": "#999999",
        "--color-accent-1": "#b3b3b3",
        "--color-accent-2": "#e6e6e6",
        "--color-dark": "#333333",
        "--color-light": "#f2f2f2",
        "--color-text-main": "#1a1a1a",
      },
      greyscale: {
        "--color-primary": "#0a0a0a",
        "--color-secondary": "#bfbfbf",
        "--color-accent-1": "#d9d9d9",
        "--color-accent-2": "#bfbfbf",
        "--color-dark": "#050505",
        "--color-light": "#ffffff",
        "--color-text-main": "#0a0a0a",
      },
      "street-magic": {
        "--color-primary": "#ffcc00",
        "--color-secondary": "#ff6600",
        "--color-accent-1": "#ff0000",
        "--color-accent-2": "#6600ff",
        "--color-dark": "#000000",
        "--color-light": "#ffffff",
        "--color-text-main": "#000000",
      },
      washington: {
        "--color-primary": "#B22234",
        "--color-secondary": "#3C3B6E",
        "--color-accent-1": "#FFFFFF",
        "--color-accent-2": "#F0EDEE",
        "--color-dark": "#212529",
        "--color-light": "#F0E68C",
        "--color-text-main": "#002D62",
      },
      rainbow: {
        "--color-primary": "#FF69B4",
        "--color-secondary": "#00BFFF",
        "--color-accent-1": "#FFD700",
        "--color-accent-2": "#32CD32",
        "--color-dark": "#8B008B",
        "--color-light": "#F0E68C",
        "--color-text-main": "#2F4F4F",
      },
      miami: {
        "--color-primary": "#ff9f1c",
        "--color-secondary": "#2ec4b6",
        "--color-accent-1": "#ffbf69",
        "--color-accent-2": "#cbf3f0",
        "--color-dark": "#011627",
        "--color-light": "#fdfffc",
        "--color-text-main": "#011627",
      },
      "neo-vegas": {
        "--color-primary": "#ff4500",
        "--color-secondary": "#ffd700",
        "--color-accent-1": "#008b8b",
        "--color-accent-2": "#8b4513",
        "--color-dark": "#282828",
        "--color-light": "#f0e68c",
        "--color-text-main": "#5c0075",
      },

      moto: {
        "--color-primary": "#FF0000",
        "--color-secondary": "#211E1E",
        "--color-accent-1": "#087E8B",
        "--color-accent-2": "#F2C641",
        "--color-dark": "#0B3C5D",
        "--color-light": "#E0E1DD",
        "--color-text-main": "#ff0000",
      },
      delhi: {
        "--color-primary": "#C8102E",
        "--color-secondary": "#FFD700",
        "--color-accent-1": "#008000",
        "--color-accent-2": "#FFFFFF",
        "--color-dark": "#4B5320",
        "--color-light": "#FADA5E",
        "--color-text-main": "#000000",
      },
      "cyber-citrus": {
        "--color-primary": "#FF8C00",
        "--color-secondary": "#FFD700",
        "--color-accent-1": "#9C4F00",
        "--color-accent-2": "#FFA500",
        "--color-dark": "#2F4F4F",
        "--color-light": "#fff266",
        "--color-text-main": "#664b00",
      },
      purple: {
        "--color-primary": "#8e44ad",
        "--color-secondary": "#9b59b6",
        "--color-accent-1": "#d2b4de",
        "--color-accent-2": "#f1e3f3",
        "--color-dark": "#2c3e50",
        "--color-light": "#ecf0f1",
        "--color-text-main": "#2c3e50",
      },
      noir: {
        "--color-primary": "#303030",
        "--color-secondary": "#0a0a0a",
        "--color-accent-1": "#262626",
        "--color-accent-2": "#333333",
        "--color-dark": "#000000",
        "--color-light": "#141414",
        "--color-text-main": "#575757",
      },
      vaporwave: {
        "--color-primary": "#ff71ce",
        "--color-secondary": "#01cdfe",
        "--color-accent-1": "#05ffa1",
        "--color-accent-2": "#b967ff",
        "--color-dark": "#21094e",
        "--color-light": "#e0c3fc",
        "--color-text-main": "#ffffff",
      },
      fuji: {
        "--color-primary": "#FFC0CB",
        "--color-secondary": "#ADD8E6",
        "--color-accent-1": "#FFFFFF",
        "--color-accent-2": "#B0E0E6",
        "--color-dark": "#778899",
        "--color-light": "#FFF0F5",
        "--color-text-main": "#2F4F4F",
      },

      y2k: {
        "--color-primary": "#00FF00",
        "--color-secondary": "#FF69B4",
        "--color-accent-1": "#0000FF",
        "--color-accent-2": "#FFD700",
        "--color-dark": "#000080",
        "--color-light": "#FFFFFF",
        "--color-text-main": "#000000",
      },
      "the-spectacle": {
        "--color-primary": "#E03E3E",
        "--color-secondary": "#0A8F08",
        "--color-accent-1": "#FFD700",
        "--color-accent-2": "#6A0DAD",
        "--color-dark": "#212529",
        "--color-light": "#F8F9FA",
        "--color-text-main": "#333333",
      },
      "pastel-goth": {
        "--color-primary": "#8A4F7D",
        "--color-secondary": "#4A4063",
        "--color-accent-1": "#F4BEEE",
        "--color-accent-2": "#9E768F",
        "--color-dark": "#22223B",
        "--color-light": "#FFFFFF",
        "--color-text-main": "#4A4A4A",
      },
      "k-punk": {
        "--color-primary": "#0A0A0A",
        "--color-secondary": "#D32F2F",
        "--color-accent-1": "#303F9F",
        "--color-accent-2": "#FBC02D",
        "--color-dark": "#000000",
        "--color-light": "#F5F5F5",
        "--color-text-main": "#ff0000",
      },
      scene: {
        "--color-primary": "#35465C",
        "--color-secondary": "#A77DC2",
        "--color-accent-1": "#58C9B9",
        "--color-accent-2": "#F4ACB7",
        "--color-dark": "#263238",
        "--color-light": "#ECEFF1",
        "--color-text-main": "#b25ed9",
      },
      sleeze: {
        "--color-primary": "#C2185B",
        "--color-secondary": "#00E5FF",
        "--color-accent-1": "#CDDC39",
        "--color-accent-2": "#FFEB3B",
        "--color-dark": "#212121",
        "--color-light": "#F5F5F5",
        "--color-text-main": "#ad8800",
      }, //
      aero: {
        "--color-primary": "#3C9EE7",
        "--color-secondary": "#EDE9E6",
        "--color-accent-1": "#4CAE50",
        "--color-accent-2": "#FFA500",
        "--color-dark": "#003366",
        "--color-light": "#FFFFFF",
        "--color-text-main": "#4D4D4D",
      },
      valley: {
        "--color-primary": "#FF6600",
        "--color-secondary": "#0A84FF",
        "--color-accent-1": "#FF1744",
        "--color-accent-2": "#FFEA00",
        "--color-dark": "#000000",
        "--color-light": "#FFFFFF",
        "--color-text-main": "#424242",
      },
      plastic: {
        "--color-primary": "#13CA91",
        "--color-secondary": "#FF48C4",
        "--color-accent-1": "#00B2FF",
        "--color-accent-2": "#FFEB3B",
        "--color-dark": "#6A1B9A",
        "--color-light": "#B2F2EF",
        "--color-text-main": "#cc8b00",
      },
      zine: {
        "--color-primary": "#F4D03F",
        "--color-secondary": "#E74C3C",
        "--color-accent-1": "#3498DB",
        "--color-accent-2": "#2ECC71",
        "--color-dark": "#34495E",
        "--color-light": "#ECF0F1",
        "--color-text-main": "#2C3E50",
      },
      bicycle: {
        "--color-primary": "#6495ED",
        "--color-secondary": "#F0F8FF",
        "--color-accent-1": "#FFD700",
        "--color-accent-2": "#D3D3D3",
        "--color-dark": "#000080",
        "--color-light": "#FFFFFF",
        "--color-text-main": "#2F4F4F",
      },
      mp3: {
        "--color-primary": "#4A90E2",
        "--color-secondary": "#AAB8C2",
        "--color-accent-1": "#F8E71C",
        "--color-accent-2": "#D0021B",
        "--color-dark": "#4A4A4A",
        "--color-light": "#FFFFFF",
        "--color-text-main": "#000000",
      },
      away: {
        "--color-primary": "#8A2BE2",
        "--color-secondary": "#DEB887",
        "--color-accent-1": "#FF69B4",
        "--color-accent-2": "#00FF7F",
        "--color-dark": "#000080",
        "--color-light": "#F5F5DC",
        "--color-text-main": "#000000",
      },
      space: {
        "--color-primary": "#3B5998",
        "--color-secondary": "#D9E6F2",
        "--color-accent-1": "#FF4500",
        "--color-accent-2": "#FFD700",
        "--color-dark": "#333333",
        "--color-light": "#FFFFFF",
        "--color-text-main": "#000000",
      },
      irc: {
        "--color-primary": "#0C7BDC",
        "--color-secondary": "#E1E8ED",
        "--color-accent-1": "#F44336",
        "--color-accent-2": "#FFEB3B",
        "--color-dark": "#37474F",
        "--color-light": "#FFFFFF",
        "--color-text-main": "#212121",
      },
      bbs: {
        "--color-primary": "#00FF00",
        "--color-secondary": "#000000",
        "--color-accent-1": "#FFFF00",
        "--color-accent-2": "#FF00FF",
        "--color-dark": "#FFFFFF",
        "--color-light": "#008000",
        "--color-text-main": "#FFFFFF",
      },
      psyc: {
        "--color-primary": "#DF00FF",
        "--color-secondary": "#FFD700",
        "--color-accent-1": "#00FF00",
        "--color-accent-2": "#FF007F",
        "--color-dark": "#0000FF",
        "--color-light": "#FFA500",
        "--color-text-main": "#FFFFFF",
      },
      1984: {
        "--color-primary": "#00A0D6",
        "--color-secondary": "#FF0090",
        "--color-accent-1": "#08F7FE",
        "--color-accent-2": "#FE53BB",
        "--color-dark": "#020122",
        "--color-light": "#F5F5F5",
        "--color-text-main": "#333333",
      },
      board: {
        "--color-primary": "#E94E77",
        "--color-secondary": "#0CDBD3",
        "--color-accent-1": "#FCF300",
        "--color-accent-2": "#66FF00",
        "--color-dark": "#202020",
        "--color-light": "#F8F8F8",
        "--color-text-main": "#202020",
      },
      terminal: {
        "--color-primary": "#FFD700",
        "--color-secondary": "#000000",
        "--color-accent-1": "#FF0000",
        "--color-accent-2": "#00FF00",
        "--color-dark": "#0000FF",
        "--color-light": "#FFFFFF",
        "--color-text-main": "#000000",
      },
      sudo: {
        "--color-primary": "#000000",
        "--color-secondary": "#000000",
        "--color-accent-1": "#000000",
        "--color-accent-2": "#000000",
        "--color-dark": "#000000",
        "--color-light": "#00FF00",
        "--color-text-main": "#000000",
      },
      korea: {
        "--color-primary": "#d22630",
        "--color-secondary": "#003478",
        "--color-accent-1": "#fcc419",
        "--color-accent-2": "#6799ff",
        "--color-dark": "#2e2e2e",
        "--color-light": "#f3f3f3",
        "--color-text-main": "#101010",
      },
      1999: {
        "--color-primary": "#00C3FF",
        "--color-secondary": "#FC28FB",
        "--color-accent-1": "#D0C310",
        "--color-accent-2": "#0CFEFE",
        "--color-dark": "#050505",
        "--color-light": "#F0F0F0",
        "--color-text-main": "#ff47a0;",
      },
      y10k: {
        "--color-primary": "#0a0f0d",
        "--color-secondary": "#1c3b3a",
        "--color-accent-1": "#4a7070",
        "--color-accent-2": "#729595",
        "--color-dark": "#050708",
        "--color-light": "#cfd8dc",
        "--color-text-main": "#00444d",
      },
      spiral: {
        "--color-primary": "#5698c4",
        "--color-secondary": "#7a6fbe",
        "--color-accent-1": "#9ad3de",
        "--color-accent-2": "#ffffff",
        "--color-dark": "#353535",
        "--color-light": "#f4f4f4",
        "--color-text-main": "#353535",
      },
      radio: {
        "--color-primary": "#6D4C41",
        "--color-secondary": "#3E2723",
        "--color-accent-1": "#D7CCC8",
        "--color-accent-2": "#A1887F",
        "--color-dark": "#1B0000",
        "--color-light": "#fbedc1;",
        "--color-text-main": "#01411e",
      },
      nakamoto: {
        "--color-primary": "#f2a900",
        "--color-secondary": "#8a8a8a",
        "--color-accent-1": "#4d4d4d",
        "--color-accent-2": "#ffffff",
        "--color-dark": "#000000",
        "--color-light": "#ffffff",
        "--color-text-main": "#f2a900",
      },
      "space-age": {
        "--color-primary": "#0b3d91",
        "--color-secondary": "#ffffff",
        "--color-accent-1": "#ff6f61",
        "--color-accent-2": "#ffd700",
        "--color-dark": "#000080",
        "--color-light": "#f8f9fa",
        "--color-text-main": "595959;",
      },
      uranium: {
        "--color-primary": "#4F7942",
        "--color-secondary": "#7FFFD4",
        "--color-accent-1": "#A7D30C",
        "--color-accent-2": "#E6E6FA",
        "--color-dark": "#003300",
        "--color-light": "#F0FFF0",
        "--color-text-main": "#4F7942",
      },
      plutonium: {
        "--color-primary": "#A40000",
        "--color-secondary": "#37ff00",
        "--color-accent-1": "#FF4500",
        "--color-accent-2": "#C0C0C0",
        "--color-dark": "#800000",
        "--color-light": "#dedede",
        "--color-text-main": "#730c0c",
      },
      "eliptic-curve": {
        "--color-primary": "#d4d41c",
        "--color-secondary": "#CB99C9",
        "--color-accent-1": "#FFBCD9",
        "--color-accent-2": "#A2A2D0",
        "--color-dark": "#000000",
        "--color-light": "#FFFFFF",
        "--color-text-main": "#4B0082",
      },
      "exit-node": {
        "--color-primary": "#8B0000",
        "--color-secondary": "#FF4500",
        "--color-accent-1": "#ff2600",
        "--color-accent-2": "#ad0000",
        "--color-dark": "#ff0000",
        "--color-light": "#ff0000",
        "--color-text-main": "#ecdfdf",
      },
      "numbers-station": {
        "--color-primary": "#505050",
        "--color-secondary": "#756400",
        "--color-accent-1": "#8B4513",
        "--color-accent-2": "#A9A9A9",
        "--color-dark": "#2F4F4F",
        "--color-light": "#F5F5F5",
        "--color-text-main": "#3d3d3d",
      },
      salmon: {
        "--color-primary": "#FF9A8A",
        "--color-secondary": "#FFD1AC",
        "--color-accent-1": "#FFB4A2",
        "--color-accent-2": "#E29587",
        "--color-dark": "#C6726B",
        "--color-light": "#FFF0E3",
        "--color-text-main": "#5C3A4D",
      },
      qubit: {
        "--color-primary": "#0C7C59",
        "--color-secondary": "#FF6B6B",
        "--color-accent-1": "#FFE66D",
        "--color-accent-2": "#4ECDC4",
        "--color-dark": "#253031",
        "--color-light": "#F7FFF7",
        "--color-text-main": "#00a300",
      },
      "san-francisco": {
        "--color-primary": "#FFA500",
        "--color-secondary": "#FFD700",
        "--color-accent-1": "#008080",
        "--color-accent-2": "#DA70D6",
        "--color-dark": "#696969",
        "--color-light": "#F5F5F5",
        "--color-text-main": "#000000",
      },
      "los-angeles": {
        "--color-primary": "#FFCC00",
        "--color-secondary": "#C0C0C0",
        "--color-accent-1": "#00AEEF",
        "--color-accent-2": "#FF6E4A",
        "--color-dark": "#2D2D2D",
        "--color-light": "#FFFFFF",
        "--color-text-main": "#000000",
      },
      hash: {
        "--color-primary": "#FF00FF",
        "--color-secondary": "#00FF00",
        "--color-accent-1": "#FFFF00",
        "--color-accent-2": "#00FFFF",
        "--color-dark": "#FF4500",
        "--color-light": "#7F00FF",
        "--color-text-main": "#c2c2c2",
      },
      "block-cipher": {
        "--color-primary": "#00FF00",
        "--color-secondary": "#00FF00",
        "--color-accent-1": "#F57C13",
        "--color-accent-2": "#F57C13",
        "--color-dark": "#C0C0C0",
        "--color-light": "#FFFF00",
        "--color-text-main": "#000000",
      },
      samizdat: {
        "--color-primary": "#CC0000",
        "--color-secondary": "#FFD700",
        "--color-accent-1": "#CC0000",
        "--color-accent-2": "#545454",
        "--color-dark": "#000000",
        "--color-light": "#fff700",
        "--color-text-main": "#000000",
      },
    };

    const applyTheme = (theme) => {
      Object.entries(theme).forEach(([key, value]) => {
        setCSSVariable(key, value);
        saveSettingToLocalStorage(key, value);
        updateSettingInputWithCurrentValue(key);
      });
    };

    const convertToHexString = (rgba) => {
      const [r, g, b, a] = rgba
        .substring(5, rgba.length - 1)
        .replace(/ /g, "")
        .split(",");
      return `#${parseInt(r).toString(16)}${parseInt(g).toString(16)}${parseInt(
        b
      ).toString(16)}`;
    };

    const asColorSelectorInputValue = (string) => {
      if (string.startsWith("#")) {
        return string;
      }
      return convertToHexString(string);
    };

    const getCSSVariable = (variable) =>
      getComputedStyle(document.documentElement).getPropertyValue(variable);

    const setCSSVariable = (variable, value) =>
      document.documentElement.style.setProperty(variable, value);

    const loadSettingsFromLocalStorage = () => {
      Object.entries(SETTINGS).forEach(([key, value]) => {
        const storedValue = localStorage.getItem(value);
        if (storedValue) {
          setCSSVariable(value, storedValue);
        }
      });
    };

    const saveSettingToLocalStorage = (setting, value) => {
      localStorage.setItem(setting, value);
    };

    const changeSetting = (setting, value) => {
      setCSSVariable(setting, value);
      saveSettingToLocalStorage(setting, value);
    };

    const updateSettingInputWithCurrentValue = (setting) => {
      document.querySelector(`#setting-input${setting}`).value =
        asColorSelectorInputValue(getCSSVariable(setting));
    };

    const resetSetting = (setting) => {
      changeSetting(setting, SETTING__DEFAULT_VALUES[setting]);
      updateSettingInputWithCurrentValue(setting);
    };

    const downloadCurrentColorTheme = () => {
      const theme = {};
      Object.entries(SETTINGS).forEach(([key, value]) => {
        theme[value] = getCSSVariable(value);
      });
      downloadJSONAsFile(theme);
    };

    const initializeSettings = () => {
      Object.entries(SETTINGS).forEach(([key, value]) => {
        try {
          const storedValue = localStorage.getItem(value);
          if (!storedValue) {
            setCSSVariable(value, SETTING__DEFAULT_VALUES[value]);
            saveSettingToLocalStorage(value, SETTING__DEFAULT_VALUES[value]);
          }

          updateSettingInputWithCurrentValue(value);

          document
            .querySelector(`#apply-setting${value}`)
            .addEventListener("click", () => {
              changeSetting(
                value,
                document.querySelector(`#setting-input${value}`).value
              );
            });

          document
            .querySelector(`#reset-setting${value}`)
            .addEventListener("click", () => resetSetting(value));
        } catch (e) {
          console.error(e);
          resetSetting(value);
        }
      });

      document
        .querySelector("#download-theme-button")
        .addEventListener("click", downloadCurrentColorTheme);

      Object.entries(themes).forEach(([key, value]) => {
        document
          .querySelector(`#button-theme-${key}`)
          .addEventListener("click", () => applyTheme(value));
      });

      document.getElementById("share-website").addEventListener("click", () => {
        window.launchShareModal();
      });
    };
  </script>

  <!-- Navigation -->
  <script type="text/javascript">
    /**
     * Navigation options
     */
    const NAVIGATION_OPTIONS = {
      TOP: "top",
      NEW: "new",
      BEST: "best",
      ASK: "ask",
      SHOW: "show",
      JOB: "job",
      FAVORITES: "favorites",
      SETTINGS: "settings",
    };

    /**
     * Updates the DOM for the selected section
     * @param {string} option
     * @returns {void}
     */
    function updateDOMForNavigationOption(option) {
      Object.entries(NAVIGATION_OPTIONS).forEach(([key, value]) => {
        if (value === option) {
          document
            .querySelector(`#nav-button-${value}`)
            .classList.add("text-link-button--selected");
        } else {
          document
            .querySelector(`#nav-button-${value}`)
            .classList.remove("text-link-button--selected");
        }
        document.querySelector(`#${value}-outlet`).style.display =
          value === option ? "block" : "none";
      });
    }

    function launchModalsFromNavigationParams() {
      const currentURL = new URL(window.location.href);

      const storyModalIdList = currentURL.searchParams.get("storyModalIdList");
      if (storyModalIdList) {
        const storyIds = storyModalIdList.split(",");
        storyIds.forEach((storyId) => {
          API.item(storyId).then((story) => launchStoryModal(story));
        });
      }

      const profileModalIdList =
        currentURL.searchParams.get("profileModalIdList");
      if (profileModalIdList) {
        const profileIds = profileModalIdList.split(",");
        profileIds.forEach((profileId) => {
          launchUserModal(profileId);
        });
      }
    }

    function addStoryModalToURL(storyId) {
      const currentURL = new URL(window.location.href);
      const currentPath = currentURL.pathname.split("/").pop();
      const currentStoryModalIdList =
        currentURL.searchParams.get("storyModalIdList");

      if (currentStoryModalIdList) {
        if (!currentStoryModalIdList.split(",").includes(storyId.toString())) {
          currentURL.searchParams.set(
            "storyModalIdList",
            `${currentStoryModalIdList},${storyId}`
          );
        }
      } else {
        currentURL.searchParams.set("storyModalIdList", storyId);
      }
      window.history.pushState({}, "", currentURL);
    }

    function removeStoryModalFromURL(storyId) {
      const currentURL = new URL(window.location.href);
      const currentPath = currentURL.pathname.split("/").pop();

      const currentStoryModalIdList =
        currentURL.searchParams.get("storyModalIdList");

      if (currentStoryModalIdList) {
        const storyIds = currentStoryModalIdList.split(",");
        const newStoryIds = storyIds.filter((id) => id !== storyId.toString());
        if (newStoryIds.length > 0) {
          currentURL.searchParams.set(
            "storyModalIdList",
            newStoryIds.join(",")
          );
        } else {
          currentURL.searchParams.delete("storyModalIdList");
        }
      }
      window.history.pushState({}, "", currentURL);
    }

    function addProfileModalToURL(profileId) {
      const currentURL = new URL(window.location.href);
      const currentPath = currentURL.pathname.split("/").pop();
      const currentProfileModalIdList =
        currentURL.searchParams.get("profileModalIdList");

      if (currentProfileModalIdList) {
        if (
          !currentProfileModalIdList.split(",").includes(profileId.toString())
        ) {
          currentURL.searchParams.set(
            "profileModalIdList",
            `${currentProfileModalIdList},${profileId}`
          );
        }
      } else {
        currentURL.searchParams.set("profileModalIdList", profileId);
      }
      window.history.pushState({}, "", currentURL);
    }

    function removeProfileModalFromURL(profileId) {
      const currentURL = new URL(window.location.href);
      const currentPath = currentURL.pathname.split("/").pop();

      const currentProfileModalIdList =
        currentURL.searchParams.get("profileModalIdList");

      if (currentProfileModalIdList) {
        const profileIds = currentProfileModalIdList.split(",");
        const newProfileIds = profileIds.filter(
          (id) => id !== profileId.toString()
        );
        if (newProfileIds.length > 0) {
          currentURL.searchParams.set(
            "profileModalIdList",
            newProfileIds.join(",")
          );
        } else {
          currentURL.searchParams.delete("profileModalIdList");
        }
      }
      window.history.pushState({}, "", currentURL);
    }

    /**
     * Attaches click listeners to navigation buttons
     * @returns {void}
     */
    function attachNavigationButtonClickListeners() {
      Object.entries(NAVIGATION_OPTIONS).forEach(([key, value]) => {
        document
          .querySelector(`#nav-button-${value}`)
          .addEventListener("click", () => {
            navigationState.update(value);
          });
      });
    }

    function applyInitialNavigationState() {
      const currentURL = new URL(window.location.href);
      const currentPath = currentURL.pathname.split("/").pop();
      if (Object.values(NAVIGATION_OPTIONS).includes(currentPath)) {
        navigationState.update(currentPath);
      } else {
        navigationState.update(NAVIGATION_OPTIONS.TOP);
      }
    }

    function applyCurrentNavigationStateToURL() {
      const currentURL = new URL(window.location.href);
      const currentPath = currentURL.pathname.split("/").pop();
      currentURL.pathname = `/${navigationState.current()}`;
      window.history.pushState({}, "", currentURL);
    }
  </script>

  <!-- Animations -->
  <script type="text/javascript">
    /**
     * Makes a modal draggable
     * @param {HTMLElement} element
     * @returns {void}
     */
    function makeModalDragable(element) {
      let mousePosition1 = 0,
        mousePosition2 = 0,
        mousePosition3 = 0,
        mousePosition4 = 0;

      let touchPosition1 = 0,
        touchPosition2 = 0,
        touchPosition3 = 0,
        touchPosition4 = 0;

      const modalTitleElement = element.querySelector(".modal-window-title");

      // Handle drag functionality from touch screen
      modalTitleElement.addEventListener("touchstart", (event) => {
        // Make sure this ignores events from nav buttons
        if (event.target.tagName === "NAV") {
          // Propagate click event to button and handle normally
          // TODO: handle this bug better
          event.target.click();
          return;
        }

        touchPosition3 = event.changedTouches[0].clientX;
        touchPosition4 = event.changedTouches[0].clientY;
      });
      modalTitleElement.addEventListener("touchend", (event) => {
        touchPosition1 = 0;
        touchPosition2 = 0;
        touchPosition3 = 0;
        touchPosition4 = 0;
      });
      modalTitleElement.addEventListener("touchcancel", (event) => {
        touchPosition1 = 0;
        touchPosition2 = 0;
        touchPosition3 = 0;
        touchPosition4 = 0;
      });
      modalTitleElement.addEventListener("touchmove", (event) => {
        event.preventDefault();
        touchPosition1 = touchPosition3 - event.changedTouches[0].clientX;
        touchPosition2 = touchPosition4 - event.changedTouches[0].clientY;
        touchPosition3 = event.changedTouches[0].clientX;
        touchPosition4 = event.changedTouches[0].clientY;
        element.style.top = element.offsetTop - touchPosition2 + "px";
        element.style.left = element.offsetLeft - touchPosition1 + "px";
      });

      // Handle Drag Functionality from mouse
      modalTitleElement.onmousedown = dragMouseDown;
      modalTitleElement.ontouchstart = dragMouseDown;

      function dragMouseDown(e) {
        e = e || window.event;
        e.preventDefault();
        // Get the mouse cursor position at startup:
        mousePosition3 = e.clientX;
        mousePosition4 = e.clientY;
        document.onmouseup = closeMouseDragElement;
        // Call a function whenever the cursor moves:
        document.onmousemove = mouseElementDrag;
      }

      function mouseElementDrag(e) {
        e = e || window.event;
        e.preventDefault();
        // Calculate the new cursor position:
        mousePosition1 = mousePosition3 - e.clientX;
        mousePosition2 = mousePosition4 - e.clientY;
        mousePosition3 = e.clientX;
        mousePosition4 = e.clientY;
        element.style.top = element.offsetTop - mousePosition2 + "px";
        element.style.left = element.offsetLeft - mousePosition1 + "px";
      }

      function closeMouseDragElement() {
        // Stop moving when mouse button is released:
        document.onmouseup = null;
        document.onmousemove = null;
      }
    }

    /**
     * Scrolls to the top of the page
     * @returns {void}
     */
    function scrollToTop() {
      document.querySelector("body").scrollIntoView({ behavior: "smooth" });
    }

    /**
     * Shows the loading animation
     * @returns {void}
     */
    function showLoadingAnimation() {
      scrollToTop();
      document.querySelector("#loading-outlet").style.display = "block";
    }

    /**
     * Hides the loading animation
     * @returns {void}
     */
    function hideLoadingAnimation() {
      scrollToTop();
      document.querySelector("#loading-outlet").style.display = "none";
    }

    /**
     * Generates a random loading string with length `length` from
     * `ANIMATION_CHARACTERS_STRING` character set.
     * @param {number} length
     * @returns {string}
     */
    function generateLoadingString(length) {
      // TODO: rewrite with reduce
      let result = "";
      for (let i = 0; i < length; i++) {
        result += ANIMATION_CHARACTERS_STRING.charAt(
          Math.floor(Math.random() * ANIMATION_CHARACTERS_STRING.length)
        );
      }
      return result;
    }

    /**
     * Precomputes loading strings for the loading animation
     * @returns {Promise<string[]>}
     * TODO:reqrite with loop
     */
    async function precomputeLoadingStrings() {
      const loadingStrings = [];
      for (let i = 0; i < TOTAL_ANIMATION_STRINGS; i++) {
        loadingStrings.push(
          generateLoadingString(
            Math.random() *
              (LOADING_STRING_MAX_LENGTH - LOADING_STRING_MIN_LENGTH) +
              LOADING_STRING_MIN_LENGTH
          )
        );
      }
      return loadingStrings;
    }

    /**
     * Returns a random loading string
     * @returns {string}
     */
    const getRandomLoadingString = () =>
      loadingStrings[Math.floor(Math.random() * TOTAL_ANIMATION_STRINGS)];

    /**
     * Initializes the loading animation
     * @returns {void}
     * TODO have generic function for batch DOM inserts
     */
    function initializeLoadingAnimation() {
      const fragment = document.createDocumentFragment();
      loop(LOADING_ANIMATION_NUMBER_OF_ROWS, (i) =>
        fragment.append(new LoadingStoryElement())
      );
      document.querySelector("#loading-outlet").appendChild(fragment);
    }
  </script>

  <!-- Custom Elements -->
  <script type="text/javascript">
    /**
     * Cache of callbacks to load stories into elements so that they are only
     * loaded as brought into view.
     */
    const storyElementLoadingCallbacks = {};

    function setModalDisplayDefaultSize(
      modal,
      mobileHeight = "99%",
      mobileWidth = "98%",
      desktopHeight = "50%",
      desktopWidth = "50%"
    ) {
      // TODO: refactor this
      if (isMobileDevice()) {
        modal.style.width =
          "calc(100vw - var(--modal-border-width) - var(--modal-border-width))";
        modal.style.height =
          "calc(100vh - var(--modal-border-width) - var(--modal-border-width))";
        modal.style.top = "0";
        modal.style.left = "0";
      } else {
        modal.style.width = desktopWidth;
        modal.style.height = desktopHeight;
        modal.style.left =
          25 +
          getRandomNumberBetween(
            -MODAL_POSITION_RANDOM_OFFSET,
            MODAL_POSITION_RANDOM_OFFSET
          ) +
          "%";
        modal.style.top =
          25 +
          getRandomNumberBetween(
            -MODAL_POSITION_RANDOM_OFFSET,
            MODAL_POSITION_RANDOM_OFFSET
          ) +
          "%";
      }
    }

    function maximizeModal(modal) {
      if (isMobileDevice()) {
        modal.style.width = "99%";
        modal.style.height = "99%";
        modal.style.top = "0";
        modal.style.left = "0";
      } else {
        modal.style.width =
          "calc(100vw - var(--modal-border-width) - var(--modal-border-width))";
        modal.style.height =
          "calc(100vh - var(--modal-border-width) - var(--modal-border-width))";
        modal.style.top = "0";
        modal.style.left = "0";
      }
    }

    /**
     * Return true if a modal takes up over 90% of the screen
     * @param {HTMLElement} modal
     * @returns {boolean}
     */
    function isModalMaximized(modal) {
      const rect = modal.getBoundingClientRect();
      return (
        rect.width > window.innerWidth * 0.9 ||
        rect.height > window.innerHeight * 0.9
      );
    }

    function useModalHeaderDoubleTapResize(modal) {
      modal
        .querySelector(".modal-window-title")
        .addEventListener("dblclick", (event) => {
          if (isModalMaximized(modal)) {
            setModalDisplayDefaultSize(modal);
          } else {
            maximizeModal(modal);
          }
        });
    }

    // TODO: reqrite modal share and maximize listeners to be reusable

    function ShareModal() {
      const modal = document.createElement("div");
      modal.classList.add(
        "modal",
        "share-modal",
        "title-actions-modal",
        "use-gpu-rendering"
      );

      modal.innerHTML = `
      <header class="modal-window-title" role="dialog" aria-modal="true">
        <div class="modal-action-buttons">
          <nav id="close-button-share" class="text-link-button" title="Close Modal">
            [X]
          </nav>
          ${
            !isMobileDevice()
              ? "<nav id='modal-window-title-maximize' class='text-link-button' title='Toggle Full Screen'>[+]</nav>"
              : ""
          }
        </div>
        <div class="title-actions-modal-title">Share</div>
        <div class="spacer"></div>
      </header>
      <main class="modal-content">
        <div class="modal-content-post-share">
            <nav id="share-twitter" class="text-link-button" title="Share on X/Twitter">Twitter</nav>
            <nav id="share-pintrest" class="text-link-button" title="Share on Pintrest">Pintrest</nav>
            <nav id="share-tumblr" class="text-link-button" title="Share on Tumblr">Tumblr</nav>
            <nav id="share-facebook" class="text-link-button" title="Share on Facebook">Facebook</nav>
            <nav id="share-linkedin" class="text-link-button" title="Share on LinkedIn">LinkedIn</nav>
            <nav id="share-whatsapp" class="text-link-button" title="Share on WhatsApp">WhatsApp</nav>
            <nav id="share-reddit" class="text-link-button" title="Share on Reddit">Reddit</nav>
            <nav id="share-telegram" class="text-link-button" title="Share on Telegram">Telegram</nav>
            <nav id="built-in" class="text-link-button" title="Share on the built in browser share feature">Native Share</nav>
            <nav id="share-email" class="text-link-button" title="Share via Email">Email</nav>
        </div>
      </main>
      `;

      useModalHeaderDoubleTapResize(modal);

      // Use smaller sizing for this modal
      // TODO: key these values for share modal as constants
      setModalDisplayDefaultSize(modal, "99%", "99%", "42%", "16.6%");

      // TODO: rewrite repeatable versino of this function
      modal
        .querySelector(`#close-button-share`)
        .addEventListener("click", () => {
          modal.remove();
        });

      // TODO: rewrite repeatable versino of this function
      if (!isMobileDevice()) {
        modal
          .querySelector(`#modal-window-title-maximize`)
          .addEventListener("click", () => {
            if (isModalMaximized(modal)) {
              setModalDisplayDefaultSize(modal);
            } else {
              maximizeModal(modal);
            }
          });
      }

      modal.querySelector("#share-twitter").addEventListener("click", () => {
        shareOnTwitter();
      });

      modal.querySelector("#share-facebook").addEventListener("click", () => {
        shareOnFacebook();
      });

      modal.querySelector("#share-linkedin").addEventListener("click", () => {
        shareOnLinkedIn();
      });

      modal.querySelector("#share-whatsapp").addEventListener("click", () => {
        shareOnWhatsApp();
      });

      modal.querySelector("#share-reddit").addEventListener("click", () => {
        shareOnReddit();
      });

      modal.querySelector("#share-telegram").addEventListener("click", () => {
        shareOnTelegram();
      });

      modal.querySelector("#share-email").addEventListener("click", () => {
        shareViaEmail();
      });

      modal.querySelector("#share-pintrest").addEventListener("click", () => {
        shareOnPintrest();
      });

      modal.querySelector("#share-tumblr").addEventListener("click", () => {
        shareOnTumblr();
      });

      modal.querySelector("#built-in").addEventListener("click", () => {
        builtInShare();
      });

      return modal;
    }

    function launchShareModal() {
      makeModalDragable(document.body.appendChild(new ShareModal()));
      // TODO: find a way to make modal dragable in constructor
    }

    function CommentListElement(item) {
      const commentContainer = document.createElement("div");
      commentContainer.id = item.id;
      commentContainer.classList.add("comment-container");

      commentContainer.innerHTML = `<div class="comment">
        <p><a id="parent-comment" class="comment-by"><strong>In Thread</strong></a></p>
        <p class="comment-text">${sanitize(item.text) || "[DELETED]"}</p>
        </div>`;

      if (item.parent) {
        commentContainer
          .querySelector(`#parent-comment`)
          .addEventListener("click", () => {
            API.item(item.parent).then((parentItem) =>
              launchStoryModal(parentItem)
            );
          });
      }

      return commentContainer;
    }

    const userProfileItemCallbacks = {};

    function UserSubmittedItemElement(itemId) {
      const storyContainer = document.createElement("div");
      storyContainer.id = itemId;
      storyContainer.classList.add("profile-item-container");

      storyContainer.innerHTML = `<span>${getRandomLoadingString()}</span>`;

      const loadItem = () => {
        API.item(itemId)
          .then(async (item) => {
            storyContainer.innerHTML = "";
            if (
              item.type === "story" ||
              item.type === "job" ||
              item.type === "poll" ||
              item.type === "pollopt"
            ) {
              storyContainer.appendChild(
                new StoryListElement(itemId, true, item)
              );
            } else if (item.type === "comment") {
              storyContainer.appendChild(new CommentListElement(item));
            } else {
              storyContainer.innerHTML = "Eᴙᴙ0ᴙ...";
            }
          })
          .catch((error) => {
            console.error(error);
            storyContainer.firstChild.textContent = "Eᴙᴙ0ᴙ...";
          });
      };

      userProfileItemCallbacks[itemId] = loadItem;

      return storyContainer;
    }

    /**
     * Story list element for a hacker news story
     * @param {number} storyId
     * @param {boolean} loadContentImmediately
     * @returns {HTMLElement}
     */
    function StoryListElement(
      storyId,
      loadContentImmediately = false,
      storyPreloaded = undefined
    ) {
      // Create html element for story
      const storyContainer = document.createElement("div");
      storyContainer.id = storyId;
      storyContainer.classList.add("story-container");

      // Assign random string for loading effect
      storyContainer.innerHTML = `<span>${getRandomLoadingString()}}</span>`;

      const renderStory = (story) => {
        if (story.deleted) {
          storyContainer.innerHTML = `<span>[DELETED]</span>`;
          return;
        }

        if (story.dead) {
          storyContainer.innerHTML = `<span>[DEAD]</span>`;
          return;
        }

        if (story.title === undefined) {
          story.title = "[NO TITLE]";
        }
        storyContainer.innerHTML = `<span>${sanitize(story.title)}</span>`;
        storyContainer.addEventListener("click", () => launchStoryModal(story));
      };

      const loadStory = () => {
        API.item(storyId)
          .then(async (story) => renderStory(story))
          .catch((error) => {
            console.error(error);
            storyContainer.firstChild.textContent = "Eᴙᴙ0ᴙ...";
          });
      };

      if (loadContentImmediately && !storyPreloaded) loadStory();

      if (storyPreloaded) renderStory(storyPreloaded);

      storyElementLoadingCallbacks[storyId] = loadStory;

      return storyContainer;
    }

    function UserModal(userId) {
      const modal = document.createElement("div");
      modal.classList.add("modal", "title-actions-modal", "use-gpu-rendering");

      modal.innerHTML = `<header class="modal-window-title" role="dialog" aria-modal="true">
        <div class="modal-action-buttons">
          <nav id="close-button-${userId}" class="text-link-button" title="Close Modal">
            [X]
          </nav>
          ${
            !isMobileDevice()
              ? "<nav id='modal-window-title-maximize' class='text-link-button' title='Toggle Full Screen'>[+]</nav>"
              : ""
          }
        </div>
        <div class="title-actions-modal-title">${userId}</div>
        <div class="spacer"></div>
      </header>

      <main class="modal-content">
        <section id="modal-content-post-${userId}" class="modal-content-post">
          <div class="user-details">
            <span class="type"><span>Loading...</span></span>
          </div>
        </section>
      </main>`;

      useModalHeaderDoubleTapResize(modal);

      setModalDisplayDefaultSize(modal);

      modal
        .querySelector(`#close-button-${userId}`)
        .addEventListener("click", () => {
          modal.remove();
          removeProfileModalFromURL(userId);
        });

      if (!isMobileDevice()) {
        modal
          .querySelector(`#modal-window-title-maximize`)
          .addEventListener("click", () => {
            if (isModalMaximized(modal)) {
              setModalDisplayDefaultSize(modal);
            } else {
              maximizeModal(modal);
            }
          });
      }

      API.user(userId).then((user) => {
        const userDetails = modal.querySelector(".user-details");
        userDetails.innerHTML = `<div class="user-description">
            <strong>JOINED:</strong> ${formatDate(user.created)}
            <br />
            <strong>KARMA:</strong> ${user.karma || 0}
            <br />
            ${user.about ? `<p>${sanitize(user.about)}</p> ` : ""}
        </div>

        <div class="user-submitted">
          <strong>SUBMITTED(${user.submitted.length}):</strong>
        </div>
        `;

        const userSubmitted = userDetails.querySelector(".user-submitted");
        user.submitted.forEach((storyId) => {
          userSubmitted.appendChild(new UserSubmittedItemElement(storyId));
        });

        const submittedStoriesObserver = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                const storyId = entry.target.id;
                if (userProfileItemCallbacks[storyId]) {
                  userProfileItemCallbacks[storyId]();
                  delete userProfileItemCallbacks[storyId];
                }
              }
            });
          },
          { rootMargin: "0px 0px 100px 0px" }
        );

        userSubmitted
          .querySelectorAll(".profile-item-container")
          .forEach((story) => {
            submittedStoriesObserver.observe(story);
          });
      });

      return modal;
    }

    function launchUserModal(userId) {
      makeModalDragable(document.body.appendChild(new UserModal(userId)));
      addProfileModalToURL(userId);
    }

    function LinkModal(url) {
      const modal = document.createElement("div");
      modal.classList.add(
        "modal",
        "use-gpu-rendering",
        "link-modal",
        "title-actions-modal"
      );

      modal.innerHTML = `<header class="modal-window-title" role="dialog" aria-modal="true">
        <nav id="close-button-link" class="text-link-button" title="Close Modal">
          [X]
        </nav>
        ${
          !isMobileDevice()
            ? "<nav id='modal-window-title-maximize' class='text-link-button' title='Toggle Full Screen'>[+]</nav>"
            : ""
        }
        <nav id="open-link" class="text-link-button" title='Open In New Tab'>
          [⬆️]
        </nav>
        <nav id="share-link" class="text-link-button" title="Share Link">
          [📤]
        </nav>
      </header>

      <main class="modal-content">
        <iframe id="link-iframe" src="${url}"></iframe>
      </main>`;

      useModalHeaderDoubleTapResize(modal);
      makeModalDragable(modal);
      setModalDisplayDefaultSize(modal);

      modal
        .querySelector(`#close-button-link`)
        .addEventListener("click", () => {
          modal.remove();
        });

      if (!isMobileDevice()) {
        modal
          .querySelector(`#modal-window-title-maximize`)
          .addEventListener("click", () => {
            if (isModalMaximized(modal)) {
              setModalDisplayDefaultSize(modal);
            } else {
              maximizeModal(modal);
            }
          });
      }

      modal.querySelector(`#open-link`).addEventListener("click", () => {
        window.open(url, "_blank");
      });

      modal
        .querySelector(`#share-link`)
        .addEventListener("click", () => launchShareModal());

      return modal;
    }

    function launchLinkModal(url) {
      makeModalDragable(document.body.appendChild(new LinkModal(url)));
    }

    /**
     * Modal that shows iframe of hacker news story and perform other actions
     * regarding story.
     * @param {object} story
     * @returns {HTMLElement}
     */
    function StoryModal(story) {
      const modal = document.createElement("div");
      modal.classList.add("modal", "use-gpu-rendering");

      const datePosted = formatDate(story.time);

      modal.innerHTML = `<header class="modal-window-title" role="dialog" aria-modal="true">
        <nav id="close-button-${
          story.id
        }" class="text-link-button" title="Close Modal">
          [X]
        </nav>

        ${
          !isMobileDevice()
            ? "<nav id='modal-window-title-maximize' class='text-link-button' title='Toggle Full Screen'>[+]</nav>"
            : ""
        }

        <nav id="open-link-${
          story.id
        }" class="text-link-button" title='Open In New Tab'>
          [⬆️]
        </nav>

        <nav id="share-story-${
          story.id
        }" class="text-link-button" title="Share Story">
          [📤]
        </nav>

        ${
          story.url
            ? '<nav id="toggle-url-or-post-button" class="text-link-button" title="Toggle Webpage Preview or Hacker News Post"> [🖥️] </nav>'
            : ""
        }

        ${
          isStoryFavorited(story.id)
            ? `<nav id="favorite-story-button-${story.id}" class="text-link-button" title="Save/Unsave story">[♥]</button>`
            : `<nav id="favorite-story-button-${story.id}" class="text-link-button" title="Save/Unsave story">[♡]</button>`
        }
      </header>

      <main class="modal-content">
          <iframe id="story-iframe-${story.id}" src="${
        story.url
      }" style="display:none;"></iframe>
          <section id="modal-content-post-${
            story.id
          }" class="modal-content-post">
            ${story.title ? `<h3>${sanitize(story.title)}</h3>` : ""}
            <p class="story-summary-statistics">
              By <a class="user-id">${story.by}</a> | ${datePosted} | ⧫ ${
        story.score
      } | ${story.descendants || 0} comments ${
        story.parent ? `| <a id="parent-comment">In Thread</a>` : ""
      }
            </p>
            ${
              story.text
                ? `<p class="story-text">${sanitize(story.text)}</p>`
                : ""
            }
            <div class="comments">
              ${
                story.descendants
                  ? '<span id="loading-comments" class="type"><span>Loading...</span></span>'
                  : ""
              }
            </div>
          </section>
      </main>`;

      useModalHeaderDoubleTapResize(modal);

      setModalDisplayDefaultSize(modal);

      modal
        .querySelector(`#open-link-${story.id}`)
        .addEventListener("click", () => {
          if (
            modal.querySelector(`#story-iframe-${story.id}`).style.display ===
            "none"
          ) {
            window.open(`${YCOMBINATOR_URL}/item?id=${story.id}`, "_blank");
          } else {
            window.open(story.url, "_blank");
          }
        });

      if (story.url) {
        modal
          .querySelector(`#toggle-url-or-post-button`)
          .addEventListener("click", () => {
            const iframe = modal.querySelector(`#story-iframe-${story.id}`);
            const post = modal.querySelector(`#modal-content-post-${story.id}`);
            if (iframe.style.display === "none") {
              iframe.style.display = "block";
              post.style.display = "none";
              modal.querySelector(`#toggle-url-or-post-button`).textContent =
                "[💬]";
            } else {
              iframe.style.display = "none";
              post.style.display = "block";
              modal.querySelector(`#toggle-url-or-post-button`).textContent =
                "[🖥️]";
            }
          });
      }

      modal
        .querySelector(`#close-button-${story.id}`)
        .addEventListener("click", () => {
          modal.remove();
          removeStoryModalFromURL(story.id);
        });

      if (!isMobileDevice()) {
        modal
          .querySelector(`#modal-window-title-maximize`)
          .addEventListener("click", () => {
            if (isModalMaximized(modal)) {
              setModalDisplayDefaultSize(modal);
            } else {
              maximizeModal(modal);
            }
          });
      }

      modal
        .querySelector(`#share-story-${story.id}`)
        .addEventListener("click", () => launchShareModal());

      const updateFavoriteButtonState = () => {
        if (isStoryFavorited(story.id)) {
          modal.querySelector(
            `#favorite-story-button-${story.id}`
          ).textContent = "[♥]";
        } else {
          modal.querySelector(
            `#favorite-story-button-${story.id}`
          ).textContent = "[♡]";
        }
      };

      modal
        .querySelector(`#favorite-story-button-${story.id}`)
        .addEventListener("click", () => {
          if (isStoryFavorited(story.id)) {
            unfavoriteStory(story.id);
          } else {
            favoriteStory(story.id);
          }
          updateFavoriteButtonState();
        });

      modal.querySelector(`.user-id`).addEventListener("click", () => {
        launchUserModal(story.by);
      });

      if (story.parent) {
        modal.querySelector(`#parent-comment`).addEventListener("click", () => {
          API.item(story.parent).then((parentItem) =>
            launchStoryModal(parentItem)
          );
        });
      }

      const loadingIndicator = modal.querySelector("#loading-comments");

      const hideLoadingMessage = () => {
        if (loadingIndicator) loadingIndicator.style.display = "none";
      };

      const loadCommentsAsync = async (itemId, parent) => {
        const currentStory = await API.item(itemId);

        if (!currentStory.kids) return; // Base case for end of coment tree

        const comments = await Promise.all(
          currentStory.kids.map((commentId) => API.item(commentId))
        );

        comments.forEach((comment) => {
          if (!comment || comment.deleted) return; // Skip if comment is null (deleted)
          const commentElement = document.createElement("div");
          commentElement.classList.add("comment");
          commentElement.innerHTML = `
            <a class="comment-by"><strong>${comment.by}</strong></a>
            <p class="comment-text">${sanitize(comment.text)}</p>
            <div class="comments-container"></div>
          `;
          loadCommentsAsync(
            comment.id,
            commentElement.querySelector(".comments-container")
          );

          commentElement
            .querySelector(".comment-by")
            .addEventListener("click", () => {
              launchUserModal(comment.by);
            });

          hideLoadingMessage();

          parent.appendChild(commentElement);
        });
      };

      loadCommentsAsync(story.id, modal.querySelector(".comments"));

      addStoryModalToURL(story.id);

      return modal;
    }

    /**
     * Loading version of normal story element that produces text glitch effect
     * @returns {HTMLElement}
     */
    function LoadingStoryElement() {
      const loadingContainer = document.createElement("div");
      loadingContainer.classList.add("story-container");

      const animationRender = () =>
        (loadingContainer.innerHTML = `<span>${generateLoadingString(
          getRandomNumberBetween(
            LOADING_STRING_MIN_LENGTH,
            LOADING_STRING_MAX_LENGTH
          )
        )}</span>`);

      const animationSpeed = getRandomNumberBetween(
        LOADING_STORY_ANIMATION_REFRESH_INTERVAL_MINIMUM,
        LOADING_STORY_ANIMATION_REFRESH_INTERVAL_MAXIMUM
      );

      const animationUpdateInterval = setInterval(
        animationRender,
        animationSpeed
      );

      animationRender();

      return loadingContainer;
    }
  </script>

  <script type="text/javascript">
    /*
     * Precomputed loading strings
     */
    let loadingStrings = ["loading..."];
    // Assign precomputed loading strings to `loadingStrings` when ready
    precomputeLoadingStrings().then((strings) => {
      loadingStrings = strings;
    });

    /**
     * Render `StoryListElement`s for top stories
     */
    const topStoryIds = reactive([], (newState) => {
      const topStoriesElement = document.querySelector("#top-outlet");
      topStoriesElement.innerHTML = "";

      const fragment = document.createDocumentFragment();
      newState.map((storyId) => {
        fragment.appendChild(new StoryListElement(storyId));
      });
      topStoriesElement.appendChild(fragment);
      startStoryIntersectionObservers();
    });

    /**
     * Render `StoryListElement`s for new stories
     */
    const newStoryIds = reactive([], (newState) => {
      const newStoriesElement = document.querySelector("#new-outlet");
      newStoriesElement.innerHTML = "";

      const fragment = document.createDocumentFragment();
      newState.map((storyId) => {
        fragment.appendChild(new StoryListElement(storyId));
      });
      newStoriesElement.appendChild(fragment);
      startStoryIntersectionObservers();
    });

    /**
     * Render `StoryListElement`s for best stories
     */
    const bestStoryIds = reactive([], (newState) => {
      const bestStoriesElement = document.querySelector("#best-outlet");
      bestStoriesElement.innerHTML = "";

      const fragment = document.createDocumentFragment();
      newState.map((storyId) => {
        fragment.appendChild(new StoryListElement(storyId));
      });
      bestStoriesElement.appendChild(fragment);
      startStoryIntersectionObservers();
    });

    /**
     * Render `StoryListElement`s for ask stories
     */
    const askStoryIds = reactive([], (newState) => {
      const askStoriesElement = document.querySelector("#ask-outlet");
      askStoriesElement.innerHTML = "";

      const fragment = document.createDocumentFragment();
      newState.map((storyId) => {
        fragment.appendChild(new StoryListElement(storyId));
      });
      askStoriesElement.appendChild(fragment);
      startStoryIntersectionObservers();
    });

    /**
     * Render `StoryListElement`s for show stories
     */
    const showStoryIds = reactive([], (newState) => {
      const showStoriesElement = document.querySelector("#show-outlet");
      showStoriesElement.innerHTML = "";

      const fragment = document.createDocumentFragment();
      newState.map((storyId) => {
        fragment.appendChild(new StoryListElement(storyId));
      });
      showStoriesElement.appendChild(fragment);
      startStoryIntersectionObservers();
    });

    /**
     * Ids corresponding to job stories. Will recompute `jobStoryElements` in
     * memory whenever it changes.
     */
    const jobStoryIds = reactive([], (newState) => {
      const jobStoriesElement = document.querySelector("#job-outlet");
      jobStoriesElement.innerHTML = "";

      const fragment = document.createDocumentFragment();
      newState.map((storyId) => {
        fragment.appendChild(new StoryListElement(storyId));
      });
      jobStoriesElement.appendChild(fragment);
      startStoryIntersectionObservers();
    });

    const onNavigationChange = (newState) => {
      updateDOMForNavigationOption(newState);
      applyCurrentNavigationStateToURL();
      scrollToTop();

      switch (newState) {
        case NAVIGATION_OPTIONS.TOP:
          API.topStories().then((storyIds) => {
            topStoryIds.update(storyIds);
          });
          break;
        case NAVIGATION_OPTIONS.NEW:
          API.newStories().then((storyIds) => {
            newStoryIds.update(storyIds);
          });
          break;
        case NAVIGATION_OPTIONS.BEST:
          API.bestStories().then((storyIds) => {
            bestStoryIds.update(storyIds);
          });
          break;
        case NAVIGATION_OPTIONS.ASK:
          API.askStories().then((storyIds) => {
            askStoryIds.update(storyIds);
          });
          break;
        case NAVIGATION_OPTIONS.SHOW:
          API.showStories().then((storyIds) => {
            showStoryIds.update(storyIds);
          });
          break;
        case NAVIGATION_OPTIONS.JOB:
          API.jobStories().then((storyIds) => {
            jobStoryIds.update(storyIds);
          });
          break;
        case NAVIGATION_OPTIONS.FAVORITES:
          renderFavorites();
          startStoryIntersectionObservers();
          break;
        case NAVIGATION_OPTIONS.SETTINGS:
          return;
        default:
          onNavigationChange(NAVIGATION_OPTIONS.TOP);
      }
    };

    /**
     * Reactive store for section selected to rended. Will change the section.
     * This also triggers recomputation of all cascading sections from their own
     * respective reactive stores.
     *
     * @param {string} initialState
     * @param {function} sideEffect
     */
    const navigationState = reactive(
      NAVIGATION_OPTIONS.TOP,
      onNavigationChange
    );

    /**
     * Launches a modal for a story
     * @param {object} story
     * @returns {void}
     */
    function launchStoryModal(story) {
      const node = document.body.appendChild(new StoryModal(story));
      // TODO: find a way to make modal dragable in constructor
      makeModalDragable(node);
    }

    /**
     * Starts intersection observers for story elements in view. These stories
     * will only load their data as they come into view.
     * @returns {void}
     */
    function startStoryIntersectionObservers() {
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              if (storyElementLoadingCallbacks[entry.target.id])
                storyElementLoadingCallbacks[entry.target.id]();

              observer.unobserve(entry.target);
            }
          });
        },
        { rootMargin: "0px 0px 100px 0px" }
      );

      document.querySelectorAll(".story-container").forEach((story) => {
        observer.observe(story);
      });
    }

    /**
     * Launches root logic of page
     * @returns {void}
     */
    async function main() {
      initializeLoadingAnimation();
      attachNavigationButtonClickListeners();
      loadSettingsFromLocalStorage();
      initializeSettings();
      renderFavorites();
      attachFavoritesListeners();
      launchModalsFromNavigationParams();
      initLinkClickInterceptBehavior();
      navigationState.update(window.location.pathname.split("/").pop());
    }

    // Call main when other data loaded
    document.onreadystatechange = () => {
      if (document.readyState === "complete") main();
    };
  </script>
</html>
