<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <title>minimal hn</title>
    <meta
      name="viewport"
      content="viewport-fit=cover, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <link rel="icon" type="image/x-icon" href="assets/icon/favicon.ico" />
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#4e8ef7" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  </head>

  <body>
    <header class="title-content">
      <h1 id="title">hn</h1>
      <nav id="nav-button-top" class="text-link-button" aria-label="Top">
        [&#128285;]
      </nav>
      <nav id="nav-button-new" class="text-link-button" aria-label="New">
        [&#10561;]
      </nav>
      <nav id="nav-button-best" class="text-link-button" aria-label="Best">
        [&#9812;]
      </nav>
      <nav id="nav-button-ask" class="text-link-button" aria-label="Ask">
        [?]
      </nav>
      <nav id="nav-button-show" class="text-link-button" aria-label="Show">
        [&#10547;]
      </nav>
      <nav id="nav-button-job" class="text-link-button" aria-label="Job">
        [$]
      </nav>
      <nav
        id="nav-button-favorites"
        class="text-link-button"
        aria-label="Favorites"
      >
        [&hearts;]
      </nav>
      <nav
        id="nav-button-settings"
        class="text-link-button"
        aria-label="Settings"
      >
        [⚙]
      </nav>
    </header>
    <main class="main-content">
      <section
        id="loading-outlet"
        class="use-gpu-rendering stories-loading-animation"
        style="display: none"
      ></section>
      <section
        id="top-outlet"
        class="use-gpu-rendering"
        style="display: none"
      ></section>
      <section
        id="new-outlet"
        class="use-gpu-rendering"
        style="display: none"
      ></section>
      <section
        id="best-outlet"
        class="use-gpu-rendering"
        style="display: none"
      ></section>
      <section
        id="ask-outlet"
        class="use-gpu-rendering"
        style="display: none"
      ></section>
      <section
        id="show-outlet"
        class="use-gpu-rendering"
        style="display: none"
      ></section>
      <section
        id="job-outlet"
        class="use-gpu-rendering"
        style="display: none"
      ></section>
      <section
        id="favorites-outlet"
        class="use-gpu-rendering"
        style="display: none"
      ></section>
      <section
        id="settings-outlet"
        class="use-gpu-rendering"
        style="display: none"
      ></section>
    </main>
  </body>

  <style>
    :root {
      /* Default olor scheme inspired by brutalist design and cyberpunk */
      --color-primary: rgba(227, 6, 19, 0.8);
      --color-secondary: rgba(255, 237, 0, 1);
      --color-tertiary: #f6d365;
      --color-accent-1: #f6d365;
      --color-accent-2: #fda085;
      --color-dark: rgba(0, 0, 0, 0.4);
      --color-light: white;
      --color-text-main: darkslategrey;

      /* Shading Utilities */
      --text-shadow-highlight: 1px 1px var(--color-primary),
        -1px -1px var(--color-secondary);
      --box-shadow-highlight: 5px 5px var(--color-primary),
        -5px -5px var(--color-secondary);
      --backgound-linear-gradient: linear-gradient(
        120deg,
        var(--color-accent-1) 0%,
        var(--color-accent-2) 100%
      );

      /* Sizing utilities */
      --size-xxs: 0.5rem;
      --size-xs: 0.75rem;
      --size-sm: 1rem;
      --size-md: 1.5rem;
      --size-lg: 2rem;
      --size-xl: 3rem;
      --size-xxl: 6rem;

      /* Breakpoints */
      --breakpoint-mobile: 600px;
      --breakpoint-tablet: 1100px;
      --breakpoint-desktop: 1600px;

      /* Misc */
      --top-level-padding-side: 1%;
    }

    * {
      font-family: Menlo, monospace;
    }

    @keyframes fade-to-black {
      100% {
        background: var(--color-dark);
      }
    }

    .use-fade-to-black {
      animation: fade-to-black 10s infinite;
    }

    ::-webkit-scrollbar {
      width: var(--size-lg);
    }

    ::-webkit-scrollbar-track {
      background: var(--color-tertiary);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--color-primary);
      border-radius: 0px;
      min-height: var(--size-xxl);
      z-index: 100;
    }

    ::-webkit-scrollbar-track:active {
      background: var(--color-secondary);
    }

    ::-webkit-scrollbar-track:hover {
      background: var(--color-secondary);
    }

    ::-webkit-scrollbar-thumb:active {
      box-shadow: 1px 3px var(--text-color);
    }

    ::-webkit-scrollbar-thumb:hover {
      box-shadow: 1px 3px var(--color-text-main);
    }

    body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      overflow: hidden;
    }

    h1 {
      font-size: var(--size-md);
      text-align: center;
      color: transparent;
      text-shadow: var(--text-shadow-highlight);
      font-weight: bold;
    }

    .use-gpu-rendering {
      -webkit-transform: translate3d(0, 0, 0);
      -moz-transform: translate3d(0, 0, 0);
      -ms-transform: translate3d(0, 0, 0);
      transform: translate3d(0, 0, 0);
      -webkit-backface-visibility: hidden;
      -moz-backface-visibility: hidden;
      -ms-backface-visibility: hidden;
      backface-visibility: hidden;
      -webkit-perspective: 1000;
      -moz-perspective: 1000;
      -ms-perspective: 1000;
      perspective: 1000;
      -webkit-transform: translateZ(0);
      -moz-transform: translateZ(0);
      -ms-transform: translateZ(0);
      -o-transform: translateZ(0);
    }

    .modal {
      display: block;
      flex-direction: column;
      position: absolute;
      z-index: 1;
      left: 0;
      top: 0;
      width: 50%;
      height: 50%;
      overflow: auto;
      background-color: var(--color-light);
      background: var(--color-light);
      border: var(--color-primary) 3px solid;
      resize: both;
      box-shadow: var(--box-shadow-highlight);
      z-index: 15;
    }

    .modal-window-title {
      cursor: move;
      height: var(--size-md);
      font-size: var(--size-sm);
      display: flex;
      align-items: left;
      background-color: var(--color-tertiary);
      color: var(--color-text-main);
      padding: var(--size-xxs);
      color: var(--color-primary);
      justify-content: space-evenly;
      border-bottom: var(--color-primary) 3px solid;
      box-shadow: var(--box-shadow-highlight);
    }

    .modal-window-title:hover {
      background-color: var(--color-secondary);
    }

    @media screen and (max-width: 1100px) {
      .modal-window-title {
        flex-direction: column;
        height: fit-content;
        text-align: center;
        align-items: center;
        font-size: var(--size-xs);
      }
    }

    .text-link-button {
      color: var(--text-color);
      text-decoration: none;
      cursor: pointer;
      transition: text-indent 0.5s;
      font-size: var(--size-sm);
      background: transparent;
      border: 0;
    }

    @media screen and (max-width: 600px) {
      .text-link-button {
        font-size: var(--size-sm);
      }
    }

    .text-link-button--selected {
      color: var(--color-primary);
      font-weight: bolder;
    }

    .text-link-button:hover {
      color: var(--color-primary);
      text-shadow: var(--text-shadow-highlight);
    }

    .modal-content {
      flex-grow: 1;
      overflow: hidden;
      background-color: var(--color-light);
      background: var(--color-light);
    }

    iframe {
      width: 100%;
      height: 100%;
      background: var(--color-light);
    }

    .title-content {
      position: absolute;
      height: var(--size-lg);
      width: 100%;
      display: flex;
      flex-direction: row;
      justify-content: flex-start;
      align-items: baseline;
      padding-left: var(--top-level-padding-side);
      background: var(--color-accent-1);
      width: calc(100vw - var(--top-level-padding-side) - var(--size-lg));
      z-index: 10;
    }

    .title-content:hover {
      background: var(--color-secondary);
    }

    .title-content h1 {
      margin: 0 var(--size-xs) 0 0;
    }

    .main-content {
      background-image: var(--backgound-linear-gradient);
      padding-left: var(--top-level-padding-side);
      padding-right: var(--top-level-padding-side);
      height: calc(100vh - var(--size-lg));
      max-height: calc(100vh - var(--size-lg));
      overflow-y: scroll;
      padding-top: var(--size-lg);
    }

    .story-container {
      margin-top: var(--size-xxs);
      margin-bottom: var(--size-xxs);
    }

    .story-container span {
      color: var(--color-text-main);
      font-size: var(--size-sm);
      cursor: pointer;
    }

    .story-container span:hover {
      color: transparent;
      font-weight: bold;
      text-indent: 5px;
      transition: text-indent 0.5s;
      text-shadow: var(--text-shadow-highlight);
    }

    .story-container span:hover::before {
      display: inline-block;
      content: "->";
    }
  </style>

  <!-- Constants -->
  <script type="text/javascript">
    const MILLISECONDS_IN_SECOND = 1_000;
    const TOTAL_ANIMATION_STRINGS = 100;
    const LOADING_STRING_MIN_LENGTH = 5;
    const LOADING_STRING_MAX_LENGTH = 80;
    const MOBILE_DEVICE_MAX_WIDTH = 600;
    const LOADING_ANIMATION_NUMBER_OF_ROWS = 50;
    const ANIMATION_CHARACTERS_STRING =
      "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_+=-[]{}|;:,.<>?♥♦♣♠•◘○◆☻☺♂♀♪♫☼►◄↕‼¶§▬↨↑↓→←∟↔▲▼ァアィイゥウェエォオカガキギクゲゴサザシジスゼソゾタダチヂッツヅテデトドナニヌネノハバパヒビピフブプヘベペホボポマミムメモャユョヨラリルレロヮワヰヱヲン々〆〤￥「」『』【】〒〓─━│┃┄┅┆┇┈┉┊┋┌┍┎┏┐┑┒┓└┕┖┗┘┙┚┛├┝┞┟┠┡┢┣┤┥┦┧┨┩┪┫┬┭┮┯┰┱┲┳┴┵┶┷┸┹┺┻┼┽┾┿╀╁╂╃╄╅╆╇╈╉╊╋╌╍╎╏═║╒╓╔╕╖╗╘╙╚╛╜╝╞╟╠╡╢╣╤╥╦╧╨╩╪╫╬§¶☊☋☌☍ΑΒΓΔΕΖΗΘΙΚΛΜΝΞΟΠΡΣΤΥΦΧΨΩαβγδεζηθικλμνξοπρςστυφχψω←↑→↓↔↕↖↗↘↙↚↛↜↝↞↟↠↡↢↣↤↥↦↧↨↩↪↫↬↭↮↯↰↱↲↳↴↵↶↷↸↹↺↻↼↽↾↿⇀⇁⇂⇃⇄⇅⇆⇇⇈⇉⇊⇋⇌⇍⇎⇏⇐⇑⇒⇓⇔⇕⇖⇗⇘⇙⇚⇛⇜⇝⇞⇟⇠⇡⇢⇣⇤⇥⇦⇧⇨⇩⇪⌨";
    // TODO: add more of these incase of future alteration
  </script>

  <!-- API -->
  <script type="text/javascript">
    const HACKER_NEWS_API_URL = "https://hacker-news.firebaseio.com/v0/";
    const HACKER_NEWS_USER_PROFILE_URL =
      "https://news.ycombinator.com/user?id=";

    // TODO: remove coupling with DOM state
    async function getRequestWithLoadingAnimation(url) {
      showLoadingAnimation();
      let response;
      try {
        response = await fetch(url);
        if (!response.ok)
          throw new Error(`HTTP error! status: ${response.status}`);
      } catch (error) {
        console.error(error);
        hideLoadingAnimation();
        throw error;
      } finally {
        hideLoadingAnimation();
      }

      return response.json();
    }

    const itemCache = new Map();

    const API = {
      topStories: () =>
        getRequestWithLoadingAnimation(`${HACKER_NEWS_API_URL}topstories.json`),
      newStories: () =>
        getRequestWithLoadingAnimation(`${HACKER_NEWS_API_URL}newstories.json`),
      bestStories: () =>
        getRequestWithLoadingAnimation(
          `${HACKER_NEWS_API_URL}beststories.json`
        ),
      askStories: () =>
        getRequestWithLoadingAnimation(`${HACKER_NEWS_API_URL}askstories.json`),
      showStories: () =>
        getRequestWithLoadingAnimation(
          `${HACKER_NEWS_API_URL}showstories.json`
        ),
      jobStories: () =>
        getRequestWithLoadingAnimation(`${HACKER_NEWS_API_URL}jobstories.json`),
      /**
     * Stories, comments, jobs, Ask HNs and even polls are just items. They're
     * identified by their ids, which are unique integers, and live under
     * /v0/item/<id>.
     *
     * All items have some of the following properties:
          [Field]     [Description]
          id	        The item's unique id.
          deleted	    true if the item is deleted.
          type    	The type of item. One of "job", "story", "comment", "poll", or "pollopt".
          by	        The username of the item's author.
          time	    Creation date of the item, in Unix Time.
          text    	The comment, story or poll text. HTML.
          dead	    true if the item is dead.
          parent  	The comment's parent: either another comment or the relevant story.
          poll	    The pollopt's associated poll.
          kids	    The ids of the item's comments, in ranked display order.
          url     	The URL of the story.
          score	    The story's score, or the votes for a pollopt.
          title	    The title of the story, poll or job. HTML.
          parts	    A list of related pollopts, in display order.
          descendants	In the case of stories or polls, the total comment count.
      *
      * For example, a story: https://hacker-news.firebaseio.com/v0/item/8863.json?print=pretty
      *
      *
      * @param {number} id
      *
      */
      item: (id) => {
        if (itemCache.has(id)) return Promise.resolve(itemCache.get(id));
        return fetch(`${HACKER_NEWS_API_URL}item/${id}.json`)
          .then((response) => response.json())
          .then((item) => {
            itemCache.set(id, item);
            return item;
          })
          .catch((error) => console.error(error));
      },
      user: (id) =>
        getRequestWithLoadingAnimation(`${HACKER_NEWS_API_URL}user/${id}.json`),
    };
  </script>

  <!-- Utils -->
  <script type="text/javascript">
    /**
     * Loop utility, does `callback` `times` times
     * @param {number} times
     * @param {function} callback
     * @returns {void}
     */
    const loop = (times, callback) => {
      for (let i = 0; i < times; i++) {
        callback(i);
      }
    };

    /**
     * Wait utility, returns a promise that resolves after `timeInMs` milliseconds
     * @param {number} timeInMs
     * @returns {Promise<void>}
     */
    function wait(timeInMs) {
      return new Promise((resolve) => {
        setTimeout(resolve, timeInMs);
      });
    }

    /**
     * Returns a random number between `min` and `max`
     * @param {number} min
     * @param {number} max
     * @returns {number}
     */
    const getRandomNumberBetween = (min, max) =>
      Math.floor(Math.random() * (max - min + 1) + min);

    function getHackerNewsPosterURLFromId(id) {
      return `${HACKER_NEWS_USER_PROFILE_URL}${id}`;
    }

    /**
     * Utility for handling state and side effects, listening for changes
     * @param {any} initialState
     * @param {function} sideEffect
     * @returns {object}
     */
    function reactive(initialState, sideEffect) {
      let state = initialState;
      const current = () => state;

      const update = (newState) => {
        state = newState;
        sideEffect(state);
      };

      const observers = [];
      const subscribe = (observer) => observers.push(observer);

      const notify = () => {
        observers.forEach((observer) => observer(state));
      };

      return {
        current,
        update,
        subscribe,
        notify,
      };
    }
  </script>

  <!-- Navigation -->
  <script type="text/javascript">
    /**
     * Navigation options
     */
    const NAVIGATION_OPTIONS = {
      TOP: "top",
      NEW: "new",
      BEST: "best",
      ASK: "ask",
      SHOW: "show",
      JOB: "job",
      FAVORITES: "favorites",
      SETTINGS: "settings",
    };

    /**
     * Updates the DOM for the selected section
     * @param {string} option
     * @returns {void}
     */
    function updateDOMForNavigationOption(option) {
      Object.entries(NAVIGATION_OPTIONS).forEach(([key, value]) => {
        if (value === option) {
          document
            .querySelector(`#nav-button-${value}`)
            .classList.add("text-link-button--selected");
        } else {
          document
            .querySelector(`#nav-button-${value}`)
            .classList.remove("text-link-button--selected");
        }
        document.querySelector(`#${value}-outlet`).style.display =
          value === option ? "block" : "none";
      });
    }

    /**
     * Attaches click listeners to navigation buttons
     * @returns {void}
     */
    function attachNavigationButtonClickListeners() {
      document
        .querySelector("#nav-button-top")
        .addEventListener("click", () => {
          selectedSection.update(NAVIGATION_OPTIONS.TOP);
        });
      document
        .querySelector("#nav-button-new")
        .addEventListener("click", () => {
          selectedSection.update(NAVIGATION_OPTIONS.NEW);
        });
      document
        .querySelector("#nav-button-best")
        .addEventListener("click", () => {
          selectedSection.update(NAVIGATION_OPTIONS.BEST);
        });
      document
        .querySelector("#nav-button-ask")
        .addEventListener("click", () => {
          selectedSection.update(NAVIGATION_OPTIONS.ASK);
        });
      document
        .querySelector("#nav-button-show")
        .addEventListener("click", () => {
          selectedSection.update(NAVIGATION_OPTIONS.SHOW);
        });
      document
        .querySelector("#nav-button-job")
        .addEventListener("click", () => {
          selectedSection.update(NAVIGATION_OPTIONS.JOB);
        });
      document
        .querySelector("#nav-button-favorites")
        .addEventListener("click", () => {
          selectedSection.update(NAVIGATION_OPTIONS.FAVORITES);
        });
      document
        .querySelector("#nav-button-settings")
        .addEventListener("click", () => {
          selectedSection.update(NAVIGATION_OPTIONS.SETTINGS);
        });
    }
  </script>

  <!-- Animations -->
  <script type="text/javascript">
    /**
     * Makes a modal draggable
     * @param {HTMLElement} element
     * @returns {void}
     */
    function makeModalDragable(element) {
      let pos1 = 0,
        pos2 = 0,
        pos3 = 0,
        pos4 = 0;

      // Only drag from the title bar
      element.querySelector(".modal-window-title").onmousedown = dragMouseDown;

      function dragMouseDown(e) {
        e = e || window.event;
        e.preventDefault();
        // Get the mouse cursor position at startup:
        pos3 = e.clientX;
        pos4 = e.clientY;
        document.onmouseup = closeDragElement;
        // Call a function whenever the cursor moves:
        document.onmousemove = elementDrag;
      }

      function elementDrag(e) {
        e = e || window.event;
        e.preventDefault();
        // Calculate the new cursor position:
        pos1 = pos3 - e.clientX;
        pos2 = pos4 - e.clientY;
        pos3 = e.clientX;
        pos4 = e.clientY;
        element.style.top = element.offsetTop - pos2 + "px";
        element.style.left = element.offsetLeft - pos1 + "px";
      }

      function closeDragElement() {
        // Stop moving when mouse button is released:
        document.onmouseup = null;
        document.onmousemove = null;
      }
    }

    /**
     * Scrolls to the top of the page
     * @returns {void}
     */
    function scrollToTop() {
      window.scrollTo(0, 0);
    }

    /**
     * Shows the loading animation
     * @returns {void}
     */
    function showLoadingAnimation() {
      scrollToTop();
      document.querySelector("#loading-outlet").style.display = "block";
    }

    /**
     * Hides the loading animation
     * @returns {void}
     */
    function hideLoadingAnimation() {
      scrollToTop();
      document.querySelector("#loading-outlet").style.display = "none";
    }

    /**
     * Returns a random loading string
     * @returns {string}
     */
    const getRandomLoadingString = () =>
      loadingStrings[Math.floor(Math.random() * TOTAL_ANIMATION_STRINGS)];

    /**
     * Initializes the loading animation
     * @returns {void}
     */
    function initializeLoadingAnimation() {
      loop(LOADING_ANIMATION_NUMBER_OF_ROWS, (i) => {
        document
          .querySelector("#loading-outlet")
          .appendChild(new LoadingStoryElement());
      });
    }
  </script>

  <!-- Custom Elements -->
  <script type="text/javascript">
    /**
     * Story list element for a hacker news story
     * @param {number} storyId
     * @returns {HTMLElement}
     */
    function StoryListElement(storyId) {
      // Create html element for story
      const storyContainer = document.createElement("div");
      storyContainer.id = storyId;
      storyContainer.classList.add("story-container");

      // Assign random string for loading effect
      storyContainer.innerHTML = `<span>${getRandomLoadingString()}}</span>`;

      API.item(storyId).then(async (story) => {
        storyContainer.firstChild.textContent = story.title;
        storyContainer.addEventListener("click", () => {
          launchStoryModal(story);
        });
      });

      return storyContainer;
    }

    /**
     * Modal that shows iframe of hacker news story and perform other actions
     * regarding story.
     * @param {object} story
     * @returns {HTMLElement}
     */
    function StoryModal(story) {
      const modal = document.createElement("div");
      modal.classList.add("modal");
      modal.classList.add("use-gpu-rendering");
      modal.innerHTML = `<div class="modal-window-title">
        <button
          id="open-link-${story.id}"
          class="text-link-button"
        >
          [OPEN IN NEW TAB]
        </button>
        <button
          id="poster-name-${story.id}"
          class="text-link-button"
        >
          [VIEW POSTER PROFILE]
        </button>
        <button id="close-button-${story.id}" class="close-button text-link-button">
          [CLOSE WINDOW]
        </button>
      </div>
      <div class="modal-content">
        <iframe id="story-iframe-${story.id}" src="${story.url}"></iframe>
      </div>`;

      if (window.innerWidth < MOBILE_DEVICE_MAX_WIDTH) {
        modal.style.width = "90%";
        modal.style.height = "99%";
      } else {
        modal.style.width = "50%";
        modal.style.height = "50%";
      }

      if (window.innerWidth < MOBILE_DEVICE_MAX_WIDTH) {
        modal.style.top = "0";
        modal.style.left = "0";
      } else {
        modal.style.top = "25%";
        modal.style.left = "25%";
      }

      modal
        .querySelector(`#open-link-${story.id}`)
        .addEventListener("click", () => {
          window.open(story.url, "_blank");
        });

      modal
        .querySelector(`#poster-name-${story.id}`)
        .addEventListener("click", () => {
          window.open(getHackerNewsPosterURLFromId(story.by), "_blank");
        });

      modal
        .querySelector(`#close-button-${story.id}`)
        .addEventListener("click", () => {
          modal.remove();
        });

      return modal;
    }

    /**
     * Loading version of normal story element that produces text glitch effect
     * @returns {HTMLElement}
     */
    function LoadingStoryElement() {
      const loadingContainer = document.createElement("div");
      loadingContainer.classList.add("story-container");

      loadingContainer.innerHTML = `<span style=>${generateLoadingString(
        getRandomNumberBetween(5, 60)
      )}</span>`;

      const interval = setInterval(
        () =>
          (loadingContainer.innerHTML = `<span>${generateLoadingString(
            getRandomNumberBetween(5, 80)
          )}</span>`),
        getRandomNumberBetween(250, 2000)
      );

      // Clear interval whenever the element is removed from the DOM
      loadingContainer.addEventListener("DOMNodeRemoved", () =>
        clearInterval(interval)
      );

      return loadingContainer;
    }
  </script>

  <script type="text/javascript">
    /**
     * Generates a random loading string with length `length` from
     * `ANIMATION_CHARACTERS_STRING` character set.
     * @param {number} length
     * @returns {string}
     */
    function generateLoadingString(length) {
      let result = "";
      for (let i = 0; i < length; i++) {
        result += ANIMATION_CHARACTERS_STRING.charAt(
          Math.floor(Math.random() * ANIMATION_CHARACTERS_STRING.length)
        );
      }
      return result;
    }

    /**
     * Precomputes loading strings for the loading animation
     * @returns {Promise<string[]>}
     */
    async function precomputeLoadingStrings() {
      const loadingStrings = [];
      for (let i = 0; i < TOTAL_ANIMATION_STRINGS; i++) {
        loadingStrings.push(
          generateLoadingString(
            Math.random() *
              (LOADING_STRING_MAX_LENGTH - LOADING_STRING_MIN_LENGTH) +
              LOADING_STRING_MIN_LENGTH
          )
        );
      }
      return loadingStrings;
    }

    /*
     * Precomputed loading strings
     */
    let loadingStrings = ["loading..."];
    // Assign precomputed loading strings to `loadingStrings` when ready
    precomputeLoadingStrings().then((strings) => {
      loadingStrings = strings;
    });

    /**
     * DOM elements for top stories list
     */
    const topStoryElements = reactive([], (newState) => {
      document.querySelector("#top-outlet").innerHTML = "";
      newState.forEach((storyElement) => {
        document.querySelector("#top-outlet").appendChild(storyElement);
      });
    });

    /**
     * Ids corresponding to top stories. Will recompute `topStoryElements` in
     * memory whenever it changes.
     */
    const topStoryIds = reactive([], (newState) => {
      topStoryElements.update(
        newState.map((storyId) => new StoryListElement(storyId))
      );
    });

    /**
     * DOM elements for stories sorted by new
     */
    const newStoryElements = reactive([], (newState) => {
      document.querySelector("#new-outlet").innerHTML = "";
      newState.forEach((storyElement) => {
        document.querySelector("#new-outlet").appendChild(storyElement);
      });
    });

    /**
     * Ids corresponding to new stories. Will recompute `newStoryElements` in
     * memory whenever it changes.
     */
    const newStoryIds = reactive([], (newState) => {
      newStoryElements.update(
        newState.map((storyId) => new StoryListElement(storyId))
      );
    });

    /**
     * DOM elements for stories sorted by best
     */
    const bestStoryElements = reactive([], (newState) => {
      document.querySelector("#best-outlet").innerHTML = "";
      newState.forEach((storyElement) => {
        document.querySelector("#best-outlet").appendChild(storyElement);
      });
    });

    /**
     * Ids corresponding to best stories. Will recompute `bestStoryElements` in
     * memory whenever it changes.
     */
    const bestStoryIds = reactive([], (newState) => {
      bestStoryElements.update(
        newState.map((storyId) => new StoryListElement(storyId))
      );
    });

    /**
     * DOM elements for stories sorted by ask
     */
    const askStoryElements = reactive([], (newState) => {
      document.querySelector("#ask-outlet").innerHTML = "";
      newState.forEach((storyElement) => {
        document.querySelector("#ask-outlet").appendChild(storyElement);
      });
    });

    /**
     * Ids corresponding to ask stories. Will recompute `askStoryElements` in
     * memory whenever it changes.
     */
    const askStoryIds = reactive([], (newState) => {
      askStoryElements.update(
        newState.map((storyId) => new StoryListElement(storyId))
      );
    });

    /**
     * DOM elements for stories sorted by show
     */
    const showStoryElements = reactive([], (newState) => {
      document.querySelector("#show-outlet").innerHTML = "";
      newState.forEach((storyElement) => {
        document.querySelector("#show-outlet").appendChild(storyElement);
      });
    });

    /**
     * Ids corresponding to show stories. Will recompute `showStoryElements` in
     * memory whenever it changes.
     */
    const showStoryIds = reactive([], (newState) => {
      showStoryElements.update(
        newState.map((storyId) => new StoryListElement(storyId))
      );
    });

    /**
     * DOM elements for stories sorted by job
     */
    const jobStoryElements = reactive([], (newState) => {
      document.querySelector("#job-outlet").innerHTML = "";
      newState.forEach((storyElement) => {
        document.querySelector("#job-outlet").appendChild(storyElement);
      });
    });

    /**
     * Ids corresponding to job stories. Will recompute `jobStoryElements` in
     * memory whenever it changes.
     */
    const jobStoryIds = reactive([], (newState) => {
      jobStoryElements.update(
        newState.map((storyId) => new StoryListElement(storyId))
      );
    });

    /**
     * DOM elements for stories marked as favorites
     */
    const favorites = reactive([], (newState) => {
      console.log("Favorites:", newState);
    });

    /**
     * Reactive store for section selected to rended. Will change the section.
     * This also triggers recomputation of all cascading sections from their own
     * respective reactive stores.
     *
     * @param {string} initialState
     * @param {function} sideEffect
     */
    const selectedSection = reactive(NAVIGATION_OPTIONS.TOP, (newState) => {
      updateDOMForNavigationOption(newState);

      switch (newState) {
        case NAVIGATION_OPTIONS.TOP:
          console.log("inside switch");
          API.topStories().then((storyIds) => {
            topStoryIds.update(storyIds);
          });
          break;
        case NAVIGATION_OPTIONS.NEW:
          API.newStories().then((storyIds) => {
            newStoryIds.update(storyIds);
          });
          break;
        case NAVIGATION_OPTIONS.BEST:
          API.bestStories().then((storyIds) => {
            bestStoryIds.update(storyIds);
          });
          break;
        case NAVIGATION_OPTIONS.ASK:
          API.askStories().then((storyIds) => {
            askStoryIds.update(storyIds);
          });
          break;
        case NAVIGATION_OPTIONS.SHOW:
          API.showStories().then((storyIds) => {
            showStoryIds.update(storyIds);
          });
          break;
        case NAVIGATION_OPTIONS.JOB:
          API.jobStories().then((storyIds) => {
            jobStoryIds.update(storyIds);
          });
          break;
        case NAVIGATION_OPTIONS.FAVORITES:
          console.log("complete me");
          break;
        case NAVIGATION_OPTIONS.SETTINGS:
          console.log("complete me");
          break;
        default:
          console.error("Invalid navigation option");
      }
    });

    /**
     * Launches a modal for a story
     * @param {object} story
     * @returns {void}
     */
    function launchStoryModal(story) {
      const node = document.body.appendChild(new StoryModal(story));
      // TODO: find a way to make modal dragable in constructor
      makeModalDragable(node);
    }

    /**
     * Launches root logic of page
     * @returns {void}
     */
    async function main() {
      initializeLoadingAnimation();
      attachNavigationButtonClickListeners();
      // This triggers root propagation of state changes
      selectedSection.update(NAVIGATION_OPTIONS.TOP);
    }

    // Call main when other data loaded
    document.onreadystatechange = () => {
      if (document.readyState === "complete") main();
    };
  </script>
</html>
